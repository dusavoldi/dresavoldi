<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Evolução Médica</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>:root{--highlight-color:rgba(219,234,254,.8)}body{font-family:Arial,sans-serif;background-color:#f3f4f6;font-size:13px}.topic-title{color:#1e40af;border-bottom:1px
solid #93c5fd;font-weight:600}.btn{transition:all .2s
ease-in-out;border-radius:6px;font-size:11px;padding:3px
8px;display:inline-flex;align-items:center;justify-content:center}.btn:disabled{opacity:.6;cursor:not-allowed}.btn-primary{background-color:#2563eb;color:#fff}.btn-primary:hover:not(:disabled){background-color:#1d4ed8}.btn-green{background-color:#16a34a;color:#fff}.btn-green:hover:not(:disabled){background-color:#15803d}.form-input{background-color:#fff;border:1px
solid #d1d5db;padding:3px
6px;font-size:12px;border-radius:6px}textarea.form-input{overflow-y:hidden;resize:none}.form-input:focus{outline:0;border-color:#2563eb;box-shadow:0
0 0 2px
#dbeafe}label{font-size:11px;font-weight:500;color:#4b5563}.preview-output{white-space:pre-wrap;background-color:#f9fafb;font-size:12px;line-height:1.6;color:#374151;height:auto;outline:0;padding:6px;border-radius:6px;border:1px
solid #e5e7eb}.preview-output
mark{background-color:var(--highlight-color);border-radius:2px;padding:1px
2px}.btn-toggle{padding:3px 10px;border:1px solid
#d1d5db;background-color:#f9fafb;color:#4b5563;font-size:11px;border-radius:6px;cursor:pointer;transition:all
.2s
ease-in-out}.btn-toggle.active{background-color:#2563eb;color:#fff;border-color:#2563eb;font-weight:600}.btn-toggle-lme{padding:4px
16px;border:1px solid
#d1d5db;background-color:#f9fafb;color:#4b5563;font-size:11px;border-radius:6px;cursor:pointer;transition:all
.2s
ease-in-out;font-weight:600}.btn-toggle-lme.active{background-color:#2563eb;color:#fff;border-color:#2563eb;font-weight:600}.btn-submodo{padding:2px
6px;font-size:10px;border-radius:4px;color:#fff;font-weight:600;cursor:pointer;transition:all
.2s;border:2px solid
transparent}.btn-submodo:hover{opacity:.85}.btn-submodo.active{border-color:#1e3a8a}.btn-hapvida{background-color:#f97316}.btn-vita{background-color:#3b82f6}.btn-sao-vicente{background-color:#14b8a6}.btn-cruz-vermelha{background-color:#f87171}.info-card{background-color:#f9fafb;border:1px
solid #f3f4f6;border-radius:8px;padding:6px}.tab-btn{padding:6px
12px;border-radius:6px 6px 0 0;font-weight:600;cursor:pointer;border:1px
solid
transparent;border-bottom:0}.tab-btn.active{background-color:#fff;border-color:#e5e7eb}.tab-btn:not(.active){background-color:#f3f4f6}.tab-content,.tab-content-left{display:none}.tab-content.active,.tab-content-left.active{display:block}.checkbox-label{display:flex;align-items:center;cursor:pointer;font-size:12px;color:#374151}.checkbox-label
input{margin-right:6px}.collapsible-content{transition:max-height .35s
ease-out,padding-top .35s ease-out,padding-bottom .35s
ease-out,margin-top .35s
ease-out;overflow:hidden;max-height:2000px}.collapsible-content.collapsed{max-height:0;padding-top:0!important;padding-bottom:0!important;margin-top:0!important}.arrow-icon{transition:transform
.3s ease-out}.collapsible-header.collapsed
.arrow-icon,.collapsible-subheader.collapsed
.arrow-icon{transform:rotate(-90deg)}.model-btn{background-color:#e5e7eb;color:#374151;padding:2px
6px;border-radius:4px;font-size:10px;font-weight:500;cursor:pointer;transition:background-color
.2s}.model-btn:hover{background-color:#d1d5db}#notification-banner{transition:transform
.5s
ease-in-out;transform:translateY(-100%)}#notification-banner.show{transform:translateY(0)}#tab-content-historico:not(.visita-medica-mode)
.visita-checkbox{display:none}.visita-checkbox{margin-left:auto}#btn-gerar-visita.hidden{display:none}.spinner{width:16px;height:16px;border:2px
solid
hsla(0,0%,100%,.3);border-radius:50%;border-top-color:#fff;animation:spin
1s ease-in-out infinite}@keyframes
spin{to{transform:rotate(1turn)}}#sync-status{display:none;position:fixed;bottom:10px;left:10px;background-color:rgba(0,0,0,.7);color:#fff;padding:6px
12px;border-radius:20px;font-size:.85rem;z-index:999;align-items:center;gap:6px}#sync-status.show{display:inline-flex}#sync-status
.spinner{width:14px;height:14px;border-top-color:#fff}.hidden{display:none!important}@media
(min-width:1024px){#right-column{position:sticky;top:.5rem;align-self:start}}</style>
<script>
// Firebase credentials inserted for NMApp
var __firebase_config = "{\"apiKey\":\"AIzASyBkSd-z_e08Unhtu2U66jCDOkYiSxpsvl10\",\"authDomain\":\"nmapp-e183e.firebaseapp.com\",\"projectId\":\"nmapp-e183e\",\"storageBucket\":\"nmapp-e183e.appspot.com\",\"messagingSenderId\":\"621715679787\",\"appId\":\"1:621715679787:web:10ca85f2b8453275963e\"}";
</script>

</head>
<body class="p-1 md:p-2">
<div id="notification-banner" class="fixed top-0 left-1/2
-translate-x-1/2 py-2 px-4 rounded-b-lg shadow-lg text-white z-50
text-center">
<p id="notification-message"></p>
</div>
<main class="container mx-auto max-w-7xl">
<div id="global-header-bar" class="flex flex-col lg:flex-row
justify-between lg:items-end -mb-px border-b border-gray-300 pb-1">
<div id="left-tabs" class="flex items-end flex-wrap w-full lg:w-auto">
<button class="tab-btn active"
data-tab-left="consulta">Consulta</button>
<button class="tab-btn" data-tab-left="historico">Histórico</button>
<button id="btn-novo-paciente" class="btn btn-green font-semibold py-1
px-3 mb-1 ml-2">Novo Paciente</button>
<div class="flex items-center space-x-1 mb-1 ml-2"
data-toggle-container="modoConsulta">
<button type="button" data-value="consultorio" class="btn-toggle
active">Consultório</button>
<button type="button" data-value="hospital"
class="btn-toggle">Hospital</button>
</div>
<div id="submodos-container" class="flex items-center space-x-1 mb-1
ml-2 hidden" data-toggle-container="subModoConsulta">
<button type="button" data-value="hapvida" data-submodo="hapvida"
class="btn-submodo btn-hapvida">Hapvida</button>
<button type="button" data-value="vita" data-submodo="vita"
class="btn-submodo btn-vita">VITA</button>
<button type="button" data-value="sao-vicente"
data-submodo="sao-vicente" class="btn-submodo btn-sao-vicente">São
Vicente</button>
<button type="button" data-value="cruz-vermelha"
data-submodo="cruz-vermelha" class="btn-submodo btn-cruz-vermelha">Cruz
Vermelha</button>
</div>
</div>
<div id="right-tabs" class="flex items-end w-full lg:w-auto
justify-start lg:justify-end mt-2 lg:mt-0">
<button class="tab-btn active" data-tab="evolucao">Evolução</button>
<button class="tab-btn" data-tab="receita">Receita</button>
<button class="tab-btn" data-tab="documentos">Documentos</button>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
<div class="flex flex-col">
<div id="left-column-content-wrapper">
<div id="tab-content-consulta" class="tab-content-left active">
<div id="form-container" class="bg-white rounded-b-lg rounded-tr-lg
shadow p-3 md:p-4 space-y-3">
<section>
<div class="flex justify-between items-center pb-1 mb-1 border-b
border-blue-300 cursor-pointer collapsible-header"
data-section-id="identificacao">
<div class="flex items-center">
<svg class="arrow-icon w-4 h-4 mr-2 text-blue-800" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg>
<h2 class="topic-title border-b-0 p-0 m-0">Identificação</h2>
</div>
</div>
<div class="space-y-2 pt-1 collapsible-content">
<div class="info-card grid grid-cols-1 md:grid-cols-3 gap-2">
<input type="text" id="paciente-nome" placeholder="Nome do Paciente"
class="form-input block w-full shadow-sm md:col-span-2">
<input type="text" id="paciente-nascimento" placeholder="D.N."
class="form-input block w-full shadow-sm" maxlength="10">
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="identificacao-detalhes">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg>
Detalhes Adicionais
</h3>
<div class="space-y-2 collapsible-content collapsed">
<div class="flex items-center" data-toggle-container="acompanhante">
<label class="mr-2 whitespace-nowrap">Acompanhante</label>
<div class="flex items-center space-x-1 flex-grow">
<button type="button" data-value="nao" class="btn-toggle
active">Não</button>
<button type="button" data-value="sim" class="btn-toggle">Sim</button>
<input type="text" id="paciente-acompanhante-detalhe" class="form-input
flex-grow shadow-sm hidden" placeholder="Nome do acompanhante">
</div>
</div>
<div class="flex items-center">
<label for="paciente-ocupacao" class="mr-2
whitespace-nowrap">Ocupação</label>
<input type="text" id="paciente-ocupacao" class="form-input w-full
shadow-sm">
</div>
</div>
</div>
</div>
</section>
<section>
<div class="flex justify-between items-center pb-1 mb-1 border-b
border-blue-300 cursor-pointer collapsible-header"
data-section-id="dados">
<div class="flex items-center">
<svg class="arrow-icon w-4 h-4 mr-2 text-blue-800" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg>
<h2 class="topic-title border-b-0 p-0 m-0 flex items-center">
Dados
<svg id="analise-spinner" class="animate-spin ml-2 h-4 w-4 text-blue-500
hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24
24">
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
stroke-width="4"></circle>
<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0
018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042
1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
</h2>
</div>
</div>
<div class="collapsible-content collapsed">
<textarea id="textarea-informacoes" class="form-input w-full shadow-sm
mt-1" rows="1" placeholder="Cole uma evolução antiga, digite livremente
para análise ou 'Novo' para limpar..."></textarea>
</div>
</section>
<section>
<h2 class="topic-title pb-1 mb-1 flex items-center cursor-pointer
collapsible-header" data-section-id="diagnosticos">
<svg class="arrow-icon w-4 h-4 mr-2" fill="none" stroke="currentColor"
viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
<span>Diagnóstico</span>
<svg id="cid-spinner" class="animate-spin ml-2 h-4 w-4 text-blue-500
hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24
24">
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
stroke-width="4"></circle>
<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0
018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042
1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
</h2>
<div class="collapsible-content">
<textarea id="textarea-diagnosticos" class="form-input w-full shadow-sm"
rows="1" placeholder="Digite os diagnósticos. Ex: Cefaleia e
enxaqueca"></textarea>
<div id="modelos-container" class="info-card mt-2">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelos-main">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg>
Modelos de Diagnóstico
</h3>
<div class="collapsible-content collapsed">
<div class="space-y-2">
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-cefaleia">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Cefaleia
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="migraneaSemAura">Migrânea s/ Aura</button>
<button type="button" class="model-btn"
data-modelo="migraneaComAura">Migrânea c/ Aura</button>
<button type="button" class="model-btn"
data-modelo="cefaleiaTensional">Tensional</button>
<button type="button" class="model-btn"
data-modelo="cefaleiaCronicaDiaria">Crônica Diária</button>
<button type="button" class="model-btn"
data-modelo="cefaleiaEmSalvas">Em Salvas</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-humor">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Humor
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn" data-modelo="tag">TAG</button>
<button type="button" class="model-btn" data-modelo="tdm">Depressão
Maior</button>
<button type="button" class="model-btn" data-modelo="tab">Bipolar
(TAB)</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-neurodivergencia">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Neurodivergência
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn" data-modelo="tdah">TDAH</button>
<button type="button" class="model-btn" data-modelo="tea">TEA</button>
<button type="button" class="model-btn"
data-modelo="dislexia">Dislexia</button>
<button type="button" class="model-btn" data-modelo="tod">TOD</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-sono">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Sono
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="insonia">Insônia</button>
<button type="button" class="model-btn"
data-modelo="sahos">SAHOS</button>
<button type="button" class="model-btn" data-modelo="spi">Pernas
Inquietas (SPI)</button>
<button type="button" class="model-btn"
data-modelo="narcolepsia">Narcolepsia</button>
<button type="button" class="model-btn"
data-modelo="sonambulismo">Sonambulismo</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-epilepsia">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Epilepsia
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="epilepsiaFocal">Focal</button>
<button type="button" class="model-btn"
data-modelo="epilepsiaGeneralizada">Generalizada</button>
<button type="button" class="model-btn" data-modelo="cnep">Crises Não
Epilépticas</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-sincope">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Síncope e Vertigem
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="sincopeVasovagal">Síncope Vasovagal</button>
<button type="button" class="model-btn"
data-modelo="vertigemCentral">Vertigem Central</button>
<button type="button" class="model-btn"
data-modelo="vertigemPeriferica">Vertigem Periférica</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-nervo">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Nervo Periférico
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="parestesiaCutanea">Parestesia Cutânea</button>
<button type="button" class="model-btn"
data-modelo="neuropatiaMetabolica">Neuropatia Metabólica</button>
<button type="button" class="model-btn"
data-modelo="neuropatiaDiabetica">Neuropatia Diabética</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-neuromuscular">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Neuromuscular
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="miasteniaGravis">Miastenia Gravis</button>
<button type="button" class="model-btn" data-modelo="ela">ELA</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-coluna">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Coluna
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="radiculopatiaCervical">Radiculopatia Cervical</button>
<button type="button" class="model-btn"
data-modelo="lombociatalgia">Lombociatalgia</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-cognicao">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Cognição
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn" data-modelo="ccl">CCL</button>
<button type="button" class="model-btn"
data-modelo="alzheimer">Alzheimer</button>
<button type="button" class="model-btn"
data-modelo="demenciaVascular">Demência Vascular</button>
<button type="button" class="model-btn"
data-modelo="demenciaLewy">Demência com Corpos de Lewy</button>
<button type="button" class="model-btn"
data-modelo="demenciaFrontotemporal">Demência Frontotemporal</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-movimento">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Transtornos do Movimento
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="tremorEssencial">Tremor Essencial</button>
<button type="button" class="model-btn"
data-modelo="doencaParkinson">Doença de Parkinson</button>
<button type="button" class="model-btn"
data-modelo="parkinsonismoAtipicoGeral">Parkinsonismo Atípico</button>
<button type="button" class="model-btn" data-modelo="ams">AMS</button>
<button type="button" class="model-btn" data-modelo="psp">PSP</button>
<button type="button" class="model-btn"
data-modelo="distonia">Distonia</button>
<button type="button" class="model-btn"
data-modelo="distoniaCervical">Distonia Cervical</button>
<button type="button" class="model-btn"
data-modelo="doencaHuntington">Doença de Huntington</button>
<button type="button" class="model-btn"
data-modelo="coreiaSydenham">Coreia de Sydenham</button>
<button type="button" class="model-btn"
data-modelo="ataxiaCerebelar">Ataxia Cerebelar</button>
<button type="button" class="model-btn"
data-modelo="ataxiaHereditaria">Ataxia Hereditária</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-cerebrovascular">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Doenças Cerebrovasculares
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" data-modelo="avciDireito">AVCi Hemisfério
Direito</button>
<button type="button" data-modelo="avciEsquerdo">AVCi Hemisfério
Esquerdo</button>
<button type="button" data-modelo="ait">AIT</button>
<button type="button" data-modelo="avch">AVCh
Intraparenquimatoso</button>
<button type="button" data-modelo="hsa">HSA</button>
<button type="button" class="model-btn" data-modelo="tvc">Trombose
Venosa Cerebral</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-inflamatorias">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Doenças Inflamatórias
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn"
data-modelo="paralisiaBell">Paralisia de Bell</button>
<button type="button" class="model-btn"
data-modelo="herpesZoster">Herpes Zoster</button>
<button type="button" class="model-btn"
data-modelo="nevralgiaPosHerpetica">Nevralgia Pós-Herpética</button>
</div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="modelo-desmielinizantes">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Doenças Desmielinizantes
</h3>
<div class="collapsible-content flex flex-wrap gap-1 pt-1 collapsed">
<button type="button" class="model-btn" data-modelo="emrr">EM
Remitente-Recorrente</button>
<button type="button" class="model-btn" data-modelo="emProgressiva">EM
Progressiva</button>
<button type="button" class="model-btn" data-modelo="cis">Síndrome
Clínica Isolada</button>
<button type="button" class="model-btn"
data-modelo="neuriteOptica">Neurite Óptica</button>
<button type="button" class="model-btn"
data-modelo="nmosd">NMOSD</button>
<button type="button" class="model-btn"
data-modelo="mieliteTransversa">Mielite Transversa</button>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section>
<h2 class="topic-title pb-1 mb-1 flex items-center cursor-pointer
collapsible-header" data-section-id="historia-inicial">
<svg class="arrow-icon w-4 h-4 mr-2" fill="none" stroke="currentColor"
viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span>História
Inicial</span>
</h2>
<div class="collapsible-content collapsed"><textarea
id="historia-inicial" class="form-input w-full shadow-sm" rows="1"
placeholder="Descrição da queixa inicial..."></textarea></div>
</section>
<section>
<h2 class="topic-title pb-1 mb-1 flex items-center cursor-pointer
collapsible-header" data-section-id="atual">
<svg class="arrow-icon w-4 h-4 mr-2" fill="none" stroke="currentColor"
viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span>Atual</span>
<svg id="resumo-spinner" class="animate-spin ml-2 h-4 w-4 text-blue-500
hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24
24">
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
stroke-width="4"></circle>
<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0
018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042
1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
</h2>
<div class="collapsible-content collapsed"><textarea id="atual"
class="form-input w-full shadow-sm" rows="1" placeholder="Resumo da
consulta atual (gerado por IA se vazio)..."></textarea></div>
</section>
<section>
<h2 class="topic-title pb-1 mb-1 flex items-center cursor-pointer
collapsible-header" data-section-id="historico">
<svg class="arrow-icon w-4 h-4 mr-2" fill="none" stroke="currentColor"
viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span>Histórico</span>
</h2>
<div class="space-y-2 collapsible-content collapsed">
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="comorbidades">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Comorbidades
</h3>
<div class="collapsible-content"><textarea id="textarea-comorbidades"
class="form-input w-full shadow-sm" rows="1" placeholder="Uma
comorbidade por linha..."></textarea></div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center" data-subsection-id="cirurgias">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Cirurgias / Hospitalizações
</h3>
<div class="collapsible-content collapsed"><textarea
id="cirurgias-hospitalizacoes" class="form-input block w-full shadow-sm"
rows="1" placeholder="Nega ou descreva..."></textarea></div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center" data-subsection-id="habitos">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Hábitos
</h3>
<div class="space-y-1 collapsible-content collapsed">
<div class="flex items-center" data-toggle-container="etilismo">
<label class="mr-2 whitespace-nowrap">Etilismo</label>
<div class="flex items-center space-x-1 flex-grow">
<button type="button" data-value="nao" class="btn-toggle
active">Nega</button>
<button type="button" data-value="sim" class="btn-toggle">Sim</button>
<input type="text" id="habito-etilismo-detalhe" class="form-input
flex-grow shadow-sm hidden" placeholder="Detalhes...">
</div>
</div>
<div class="flex items-center" data-toggle-container="tabagismo">
<label class="mr-2 whitespace-nowrap">Tabagismo</label>
<div class="flex items-center space-x-1 flex-grow">
<button type="button" data-value="nao" class="btn-toggle
active">Nega</button>
<button type="button" data-value="sim" class="btn-toggle">Sim</button>
<input type="text" id="habito-tabagismo-detalhe" class="form-input
flex-grow shadow-sm hidden" placeholder="Detalhes...">
</div>
</div>
</div>
</div>
</div>
</section>
<section>
<h2 class="topic-title pb-1 mb-1 flex items-center cursor-pointer
collapsible-header" data-section-id="medicamentos">
<svg class="arrow-icon w-4 h-4 mr-2" fill="none" stroke="currentColor"
viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
<span>Medicamentos</span>
</h2>
<div class="space-y-2 collapsible-content collapsed">
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center" data-subsection-id="uso-atual">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Uso Atual
</h3>
<div class="collapsible-content"><textarea
id="textarea-medicamentos-atuais" class="form-input w-full shadow-sm"
rows="1" placeholder="Losartana 50mg 1-0-0..."></textarea></div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="uso-previo">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Uso Prévio
</h3>
<div class="collapsible-content collapsed"><textarea
id="textarea-medicamentos-previos" class="form-input w-full shadow-sm"
rows="1" placeholder="Nega ou descreva..."></textarea></div>
</div>
</div>
</section>
<section>
<h2 class="topic-title pb-1 mb-1 flex items-center cursor-pointer
collapsible-header" data-section-id="complementares">
<svg class="arrow-icon w-4 h-4 mr-2" fill="none" stroke="currentColor"
viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span>Exames
Complementares</span>
</h2>
<div class="collapsible-content collapsed"><textarea
id="textarea-complementares" class="form-input w-full shadow-sm"
rows="1" placeholder="RM Crânio (01/01/25): sem
alterações..."></textarea></div>
</section>
<section>
<h2 class="topic-title pb-1 mb-1 flex items-center cursor-pointer
collapsible-header" data-section-id="exame-fisico">
<svg class="arrow-icon w-4 h-4 mr-2" fill="none" stroke="currentColor"
viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span>Exame
Físico/Neurológico</span>
</h2>
<div class="collapsible-content collapsed"><textarea id="exame-fisico"
class="form-input w-full shadow-sm" rows="1" placeholder="Vigil,
orientado..."></textarea></div>
</section>
<section>
<h2 class="topic-title pb-1 mb-1 flex items-center cursor-pointer
collapsible-header" data-section-id="conduta">
<svg class="arrow-icon w-4 h-4 mr-2" fill="none" stroke="currentColor"
viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span>Conduta</span>
</h2>
<div class="space-y-2 collapsible-content">
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="conduta-medicamento">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Medicamento
</h3>
<div class="collapsible-content"><textarea id="textarea-terapia"
class="form-input w-full shadow-sm" rows="1" placeholder="desvenlafaxina
50mg 1-0-0 | prednisona bell..."></textarea></div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="conduta-exames">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Exames
</h3>
<div class="collapsible-content collapsed"><textarea id="conduta-exames"
class="form-input w-full shadow-sm" rows="1" placeholder="Solicito RM de
Crânio..."></textarea></div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="conduta-encaminhamento">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Encaminhamento
</h3>
<div class="collapsible-content collapsed"><textarea
id="conduta-encaminhamento" class="form-input w-full shadow-sm" rows="1"
placeholder="Encaminho para Fisioterapia..."></textarea></div>
</div>
<div class="info-card">
<h3 class="font-semibold text-gray-700 text-sm mb-1 cursor-pointer
collapsible-subheader flex items-center"
data-subsection-id="conduta-documentos">
<svg class="arrow-icon w-3 h-3 mr-2 text-gray-600" fill="none"
stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round"
stroke-linejoin="round" stroke-width="2" d="M19 9l-7
7-7-7"></path></svg> Documentos
</h3>
<div class="collapsible-content collapsed">
<div id="conduta-documentos-container" class="grid grid-cols-2 gap-x-4
gap-y-1 mt-1">
<div class="col-span-2 flex items-center space-x-2">
<label class="checkbox-label flex-shrink-0"><input type="checkbox"
name="documento" value="Atestado" id="checkbox-atestado"
data-target="atestado"> Atestado</label>
<input type="text" id="atestado-dias" class="form-input w-24 shadow-sm
hidden transition-all" placeholder="Nº de dias">
</div>
<div class="col-span-2 flex items-center space-x-2">
<label class="checkbox-label flex-shrink-0"><input type="checkbox"
name="documento" value="Declaração" id="checkbox-declaracao"
data-target="declaracao"> Declaração</label>
<input type="text" id="declaracao-acompanhante" class="form-input w-full
shadow-sm hidden transition-all" placeholder="Nome do Acompanhante
(Opcional)">
</div>
<div class="col-span-2">
<label class="checkbox-label"><input type="checkbox" name="documento"
value="Laudo" id="checkbox-laudo" data-target="laudo"> Laudo</label>
<div id="laudo-opcoes" class="pl-5 pt-1 space-y-1 hidden">
<label class="checkbox-label text-xs"><input type="radio"
name="laudo-tipo" value="Diagnóstico" checked> Diagnóstico</label>
<label class="checkbox-label text-xs"><input type="radio"
name="laudo-tipo" value="Incapacidade"> Incapacidade</label>
<label class="checkbox-label text-xs"><input type="radio"
name="laudo-tipo" value="Concurso"> Concurso</label>
<label class="checkbox-label text-xs"><input type="radio"
name="laudo-tipo" value="Neurodivergente"> Neurodivergente</label>
</div>
</div>
<div class="col-span-2">
<label class="checkbox-label"><input type="checkbox" name="documento"
value="Orientações" id="checkbox-orientacoes" data-target="orientacoes">
Orientações</label>
<div id="orientacoes-opcoes" class="pl-5 pt-1 space-y-1 hidden">
<label class="checkbox-label text-xs"><input type="radio"
name="orientacoes-tipo" value="AVC" checked> AVC</label>
<label class="checkbox-label text-xs"><input type="radio"
name="orientacoes-tipo" value="Cefaleia"> Cefaléia</label>
<label class="checkbox-label text-xs"><input type="radio"
name="orientacoes-tipo" value="Lombalgia"> Lombalgia</label>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</div>
</div>
<div id="tab-content-historico" class="tab-content-left">
<div class="p-1">
<div class="flex justify-between items-center mb-2">
<h3 class="font-semibold text-gray-700">Buscar Paciente</h3>
<div class="flex items-center space-x-2">
<button id="btn-visita-medica" class="btn bg-gray-200 hover:bg-gray-300
text-gray-700 font-semibold py-1 px-3">Visita Médica</button>
<button id="btn-gerar-visita" class="btn btn-green font-semibold py-1
px-3 hidden">Gerar</button>
</div>
</div>
<input type="text" id="search-historico" class="form-input w-full"
placeholder="Buscar por Nome, Idade, ou Diagnóstico...">
<div id="evolutions-today-container" class="mt-4">
<h4 class="font-semibold text-gray-700 text-sm mb-2 border-b
pb-1">Evoluções de Hoje</h4>
<div id="evolutions-today-list" class="space-y-1 max-h-64
overflow-y-auto">
</div>
</div>
<div id="search-results-container" class="mt-3 space-y-2"></div>
</div>
</div>
</div>
</div>
<div id="right-column">
<div class="bg-white rounded-t-lg shadow p-3 md:p-4">
<div id="tab-content-evolucao" class="tab-content active">
<div class="flex items-center justify-between mb-2">
<h3 class="font-semibold text-gray-700">Prévia da Evolução</h3>
<button id="btn-copiar-evolucao" class="btn btn-primary font-semibold
py-1 px-3">Salvar & Copiar</button>
</div>
<pre id="evolucao-output" class="preview-output font-mono">Carregando
dados...</pre>
</div>
<div id="tab-content-receita" class="tab-content">
<div class="flex items-center justify-between mb-3">
<h3 class="font-semibold text-gray-700">Receitas</h3>
<div class="flex items-center space-x-2">
<button id="btn-imprimir-receitas" class="btn bg-gray-200
hover:bg-gray-300 text-gray-700 font-semibold py-1
px-4">Imprimir</button>
<button id="btn-copiar-todas-receitas" class="btn btn-primary
font-semibold py-1 px-4">Copiar Todas</button>
</div>
</div>
<div id="receita-container" class="space-y-3"></div>
</div>
<div id="tab-content-documentos" class="tab-content">
<div class="flex items-center justify-between mb-3">
<h3 class="font-semibold text-gray-700">Documentos</h3>
<div class="flex items-center space-x-2">
<button id="btn-imprimir-documentos" class="btn bg-gray-200
hover:bg-gray-300 text-gray-700 font-semibold py-1
px-4">Imprimir</button>
<button id="btn-copiar-todos-documentos" class="btn btn-primary
font-semibold py-1 px-4">Copiar Todos</button>
</div>
</div>
<div id="documentos-container" class="space-y-3"></div>
</div>
</div>
<div id="orientacoes-preview-wrapper" class="bg-white rounded-b-lg
shadow p-3 md:p-4 mt-4">
<h3 class="font-semibold text-gray-700 mb-2">Orientações</h3>
<pre id="orientacoes-output" class="preview-output font-mono">Carregando
orientações...</pre>
</div>
</div>
</div>
</main>
<div id="sync-status">
<div class="spinner"></div>
<span id="sync-status-text">Sincronizando...</span>
</div>
<footer class="text-center mt-3 text-gray-500 text-xs">
<p>Sistema de Evolução Médica &copy; 2025</p>
</footer>
<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, signInWithCustomToken,
onAuthStateChanged } from
"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import {
getFirestore, doc, setDoc, onSnapshot, collection, query,
where, orderBy, limit, getDocs, serverTimestamp,
Timestamp, documentId
} from
"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
const AppConfig = {
FIREBASE_APP_ID: typeof __app_id !== 'undefined' ? __app_id :
'default-app-id',
FIREBASE_CONFIG: typeof __firebase_config !== 'undefined' ?
JSON.parse(__firebase_config) : {},
INITIAL_AUTH_TOKEN: typeof __initial_auth_token !== 'undefined' ?
__initial_auth_token : null,
GEMINI_API_URL:
"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=",
API_KEY: "",
FB_ROOT_COLLECTION: 'artifacts',
FB_USERS_COLLECTION: 'users',
FB_PACIENTES_COLLECTION: 'pacientes'
};
const StorageKeys = { LAST_PATIENT_ID: 'last_patient_id' };
const NotificationTypes = { SUCCESS: 'success', ERROR: 'error', WARNING:
'warning', INFO: 'info' };
const UI_CLASSES = { HIDDEN: 'hidden', ACTIVE: 'active', BTN_PRIMARY:
'btn-primary', BTN_GRAY: 'bg-gray-200', BTN_GRAY_HOVER:
'hover:bg-gray-300', TEXT_GRAY: 'text-gray-700' };
const AppState = {
db: null, auth: null, userId: null, unsubscribePatientListener: null,
currentPatientId: null,
isProgrammaticChange: false, isSaving: false, currentPatientData: {},
debouncedSaveTimer: null, cidCache: new Map()
};
const StaticData = {
SIGLAS: { 'RM':'Ressonância
Magnética','ECG':'Eletrocardiograma','EEG':'Eletroencefalograma','TC':'Tomografia
Computadorizada','HAS':'Hipertensão Arterial
Sistêmica','HPB':'Hiperplasia Prostática Benigna','AVC':'Acidente
Vascular Cerebral','AIT':'Acidente Isquêmico Transitório','IAM':'Infarto
Agudo do Miocárpio','DPOC':'Doença Pulmonar Obstrutiva
Crônica','UTI':'Unidade de Terapia Intensiva','PS':'Pronto
Socorro','DM':'Diabetes Mellitus','IRC':'Insuficiência Renal
Crônica','PA':'Pressão Arterial','FC':'Frequência
Cardíaca','FR':'Frequência Respiratória','S/A':'Sem
Alterações','HD':'Hipótese
Diagnóstica','CD':'Conduta','ABD':'Abdômen','SNC':'Sistema Nervoso
Central','SNP':'Sistema Nervoso Periférico','LCR':'Líquido
Cefalorraquidiano','USG':'Ultrassonografia','CP':'Coluna
Posterior','TCE':'Traumatismo Cranioencefalográfico' },
LME_MEDICAMENTOS: new Set(['alentuzumabe', 'azatioprina',
'betainterferona', 'cladribina', 'fingolimode', 'fumarato de dimetila',
'gabapentina', 'glatiramer', 'natalizumabe', 'teriflunomida',
'canabidiol', 'donepezila', 'galantamina', 'memantina', 'rivastigmina',
'clobazam', 'etossuximida', 'lamotrigina', 'levetiracetam', 'primidona',
'topiramato', 'vigabatrina', 'ciclosporina', 'imunoglobulina humana',
'piridostigmina', 'amantadina', 'bromocriptina', 'clozapina',
'entacapona', 'pramipexol', 'rasagilina', 'riluzol', 'risperidona']),
MEDICAMENTO_MAP: { 'desvenlafaxina':'(Pristiq /
Deller)','pregabalina':'(Prebictal /
Insit)','topiramato':'(Amato)','escitalopram':'(Lexapro /
Exodus)','fluoxetina':{ref:'(Prozac /
Daforin)',form:'cápsula'},'vortioxetina':'(Brintellix /
Vurtuoso)','sertralina':'(Zoloft /
Tolrest)','paracetamol':'(Tylenol)','ibuprofeno':'(Alivium)','naratriptana':'(Naramig)','sumatriptana':'(Sumax)','ondansetrona':'(Vonau
Flash)','ciclobenzaprina':'(Miosan)','colírio lubrificante':'(Hyabak /
Lacrima Plus)','gel oftálmico':'(Epitegel)','passiflora
incarnata':'(Pasalix PI / Sosseg)','meclizina comprimidos
mastigáveis':'(Meclin
Jet)','mecobalamina':'(Dozemast)','tiamina+piridoxina+cianocobalamina':'(Citoneurin
5.000)','dozemast np':'(Dozemast
NP)','nortriptilina':{ref:'(Pamelor)',form:'cápsula'},'duloxetina':{ref:'(Cymbalta
/
Velija)',form:'cápsula'},'trazodona':'(Donaren)','ramelteona':'(Rahime)','difenidramina':'(Lenix)','quetiapina':'(Seroquel
/ Quetros)','quetiapina liberação prolongada':'(Seroquel
XRO)','valaciclovir':'(Valtrex)','bupropiona liberação
prolongada':'(Wellbutrin XL / Bup
XL)','atomoxetina':{ref:'(Atentah)',form:'cápsula'},'risperidona':'(Risperdal
/ Zargus)','ariprazol':'(Aristab)','ácido acetilsalicílico':'(Aspirina
Prevent)','clopidogrel':'(Plavix / Clopin)','rosuvastatina':'(Crestor /
Trezor)','ácido acetilsalicílico e clopidogrel':'(Clopin
Duo)','levetiracetam':'(Keppra)','divalproato de sódio':'(Depakote ER /
Divalcon
ER)','lamotrigina':'(Lamictal)','oxcarbazepina':'(Trileptal)','fenitoína':'(Hidantal)','galantamina -
cápsulas de liberação prolongada':{ref:'(Reminyl ER /
Regressa)',form:'cápsula'},'donepezila':'(Donila)','memantina':'(Ebix /
Alois)','donepezila + memantina':'(Alois
Duo)','levodopa+benserazida':'(Prolopa BD /
Ekson)','entacapona':'(Comtan)','levodopa+carbidopa+entacapona':'(Stalevo)','pramipexol
liberação prolongada':'(Sifrol ER / Pisa)','amantadina':'(Mantidan)' },
RECEITAS_ESPECIAIS: { 'desvenlafaxina 50mg 1-0-0': { uso: "USO ORAL E
CONTÍNUO", medicamento: "Desvenlafaxina (Pristiq / Deller) 50mg",
quantidade: "60 comprimidos", instrucoes: ["Tome 1 comprimido após o
café da manhã"] }, 'desvenlafaxina 100mg 1-0-0': { uso: "USO ORAL E
CONTÍNUO", medicamento: "Desvenlafaxina (Pristiq / Deller) 100mg",
quantidade: "60 comprimidos", instrucoes: ["Tome 1 comprimido após o
café da manhã"] }, 'escitalopram 10mg - inicio': { uso: "USO ORAL E
CONTÍNUO", medicamento: "Escitalopram (Lexapro / Exodus) 10mg",
quantidade: "60 comprimidos", instrucoes: ["Tome 0,5 (meio) comprimido
ao dia por 7 dias", "Após 7 dias, passe a tomar 1 comprimido ao dia,
todos os dias"] }, 'escitalopram 10mg': { uso: "USO ORAL E CONTÍNUO",
medicamento: "Escitalopram (Lexapro / Exodus) 10mg", quantidade: "60
comprimidos", instrucoes: ["Tome 1 comprimido ao dia, todos os dias"] },
'escitalopram 15mg': { uso: "USO ORAL E CONTÍNUO", medicamento:
"Escitalopram (Lexapro / Exodus) 15mg", quantidade: "60 comprimidos",
instrucoes: ["Tome 1 comprimido ao dia, todos os dias"] }, 'escitalopram
20mg': { uso: "USO ORAL E CONTÍNUO", medicamento: "Escitalopram (Lexapro
/ Exodus) 20mg", quantidade: "60 comprimidos", instrucoes: ["Tome 1
comprimido ao dia, todos os dias"] }, 'fluoxetina 10mg 1-0-0': { uso:
"USO ORAL E CONTÍNUO", medicamento: "Fluoxetina (Prozac / Daforin)
10mg", quantidade: "60 cápsulas", instrucoes: ["Tome 1 cápsula pela
manhã"] }, 'fluoxetina 20mg 1-0-0': { uso: "USO ORAL E CONTÍNUO",
medicamento: "Fluoxetina (Prozac / Daforin) 20mg", quantidade: "60
cápsulas", instrucoes: ["Tome 1 cápsula pela manhã"] }, 'fluoxetina 10mg
2-0-0': { uso: "USO ORAL E CONTÍNUO", medicamento: "Fluoxetina (Prozac /
Daforin) 20mg", quantidade: "120 cápsulas", instrucoes: ["Tome 2
cápsulas pela manhã"] }, 'vortioxetina - inicio': { uso: "USO ORAL E
CONTÍNUO", medicamento: "Vortioxetina (Brintellix / Vurtuoso) 10mg",
quantidade: "60 comprimidos", instrucoes: ["Tome 0,5 (meio) comprimido
ao dia por 7 dias", "Após 7 dias, passe a tomar 1 comprimido ao dia,
todos os dias"] }, 'vortioxetina 10mg': { uso: "USO ORAL E CONTÍNUO",
medicamento: "Vortioxetina (Brintellix / Vurtuoso) 10mg", quantidade:
"60 comprimidos", instrucoes: ["Tome 1 comprimido ao dia, todos os
dias"] }, 'vortioxetina 20mg': { uso: "USO ORAL E CONTÍNUO",
medicamento: "Vortioxetina (Brintellix / Vurtuoso) 20mg", quantidade:
"60 comprimidos", instrucoes: ["Tome 1 comprimido ao dia, todos os
dias"] }, 'paracetamol': { uso: "USO ORAL", medicamento: "Paracetamol
(Tylenol) 750mg", quantidade: "01 caixa", instrucoes: ["Tome 1
comprimido até de 6/6h, se dor", "Evite tomar mais que 3 comprimidos por
semana"] }, 'ibuprofeno': { uso: "USO ORAL", medicamento: "Ibuprofeno
(Alivium) 600mg", quantidade: "01 caixa", instrucoes: ["Tome 1
comprimido até de 8/8h, se dor forte", "Evite tomar mais que 3
comprimidos por semana", "Não tome mais que 5 dias seguidos"] },
'naratriptana': { uso: "USO ORAL", medicamento: "Naratriptana (Naramig)
2,5mg", quantidade: "01 caixa", instrucoes: ["Tome 1 comprimido, se dor
de cabeça forte", "Se não melhorar dentro de 4 horas, tome o 2º
comprimido", "Não tome mais que 2 comprimidos ao dia", "Evite tomar mais
que 3 comprimidos na semana"] }, 'sumatriptana': { uso: "USO ORAL",
medicamento: "Sumatriptana (Sumax) 50mg", quantidade: "01 caixa",
instrucoes: ["Tome 1 comprimido, se dor de cabeça forte", "Se não
melhorar dentro de 2 horas, tome o 2º comprimido", "Não tome mais que 2
comprimidos ao dia", "Evite tomar mais que 3 comprimidos na semana"] },
'vonau': { uso: "USO SUBLINGUAL", medicamento: "Ondansetrona (Vonau
Flash) 4mg", quantidade: "01 caixa", instrucoes: ["Absorver em baixo da
língua 1 comprimido a cada 8 horas, se náusea ou vômito"] },
'ciclobenzaprina': { uso: "USO ORAL", medicamento: "Ciclobenzaprina
(Miosan) 5mg", quantidade: "7 comprimidos", instrucoes: ["Tome 1
comprimido antes de dormir, por 7 dias"] }, 'prednisona 20mg': { uso:
"USO ORAL", medicamento: "Prednisona 5mg", quantidade: "70 comprimidos",
instrucoes: ["1ª SEMANA: Tome 4 comprimidos as 08h", "2ª SEMANA: Tome 3
comprimidos as 08h", "3ª SEMANA: Tome 2 comprimidos as 08h", "4ª SEMANA:
Tome 1 comprimidos as 08h", "5ª SEMANA: Pare de usar o medicamento"] },
'colírio': [ { uso: "USO OFTÁLMICO", medicamento: "Colírio Lubrificante
(Hyabak / Lacrima Plus)", quantidade: "01 caixa", instrucoes: ["Aplicar
1 gota no olho a cada 4 horas ou se sentir irritação local"] }, { uso:
"USO OFTÁLMICO", medicamento: "Gel Oftálmico (Epitegel)", quantidade:
"01 caixa", instrucoes: ["Aplicar 1 gota no saco conjuntival inferior de
manhã e de tarde", "Ao dormir, aplicar 1 gota no saco conjuntival
inferior e fechar o olho com Gaze e fixar com micropore"] } ],
'passiflora': { uso: "USO ORAL", medicamento: "Passiflora Incarnata
500mg (Pasalix PI / Sosseg)", quantidade: "01 caixa", instrucoes: ["Tome
1 comprimido até de vezes ao dia, se necessário"] }, 'meclizina': [ {
uso: "USO ORTÁLMICO", medicamento: "Meclizina Comprimidos mastigáveis
(Meclin Jet) 25mg", quantidade: "30 comprimidos", instrucoes: ["Mastigar
1 comprimido a cada 12 horas por até 7 dias, se tontura"] }, { uso: "USO
SUBLINGUAL", medicamento: "Ondansetrona (Vonau Flash) 4mg", quantidade:
"30 comprimidos", instrucoes: ["Absorver em baixo da língua 1 comprimido
a cada 8 horas, se náusea ou vômito"] } ], 'vitamina b vo': { uso: "USO
SUBLINGUAL", medicamento: "Mecobalamina (Dozemast) 1000mcg", quantidade:
"60 comprimidos", instrucoes: ["Absorver sublingual 1 comprimido ao dia,
por 60 dias"] }, 'vitamina b im': { uso: "USO INTRAMUSCULAR",
medicamento: "Tiamina+Piridoxina+Cianocobalamina (Citoneurin 5.000)
100mg/100mg/5000mcg", quantidade: "6 ampolas", instrucoes: ["- Aplicar 1
ampola por semana, por 3 semanas, via intramuscular, em serviço de
saúde", "- Após 3 semanas, Aplicar 1 ampola por mês, por mais 3 meses,
via intramuscular, em serviço de saúde"] }, 'vitamina d': { uso: "USO
ORAL", medicamento: "Vitamina D3 (colecalciferol) 50.000UI", quantidade:
"8 comprimidos / cápsulas", instrucoes: ["Tome 1 comprimido / cápsula
por semana"] }, 'dozemast np': { uso: "USO ORAL", medicamento: "Dozemast
NP", quantidade: "60 comprimidos", instrucoes: ["Tome 1 comprimido ao
dia"] }, 'vitamina b+d': { uso: "USO ORAL", medicamento: "Manipulado",
quantidade: "60 cápsulas", instrucoes: ["Vitamina D - 7.000UI\nVitamina
B9 (Ácido Fólico) - 5 mg\nVitamina B1 (nitrato de tiamina) - 100
mg\nVitamina B6 (cloridrato de piridoxina) - 100 mg\nVitamina B12
(cianocobalamina) - 5.000 mcg", "Tome 1 cápsula ao dia, por 60 dias"] },
'pamelor 10mg 0-0-1': { uso: "USO ORAL E CONTÍNUO", medicamento:
"Nortriptilina (Pamelor) 10mg", quantidade: "60cápsulas", instrucoes:
["Tome 1 cápsulas antes de dormir"] }, 'pamelor 20mg 0-0-1': { uso: "USO
ORAL E CONTÍNUO", medicamento: "Nortriptilina (Pamelor) 10mg",
quantidade: "120 cápsulas", instrucoes: ["Tome 1 cápsula antes de
dormir, por 7 dias", "Após 7 dias, passe a tomar 2 cápsulas antes de
dormir, todas as noites"] }, 'pamelor 25mg 0-0-1': { uso: "USO ORAL E
CONTÍNUO", medicamento: "Nortriptilina (Pamelor) 25mg", quantidade: "60
cápsulas", instrucoes: ["Tome 1 cápsula antes de dormir"] }, 'pamelor
50mg 0-0-1': { uso: "USO ORAL E CONTÍNUO", medicamento: "Nortriptilina
(Pamelor) 50mg", quantidade: "60 cápsulas", instrucoes: ["Tome 1 cápsula
antes de dormir"] }, 'topiramato 25mg 0-0-1': { uso: "USO ORAL E
CONTÍNUO", medicamento: "Topiramato (Amato) 25mg", quantidade: "60
comprimidos", instrucoes: ["Tome 1 comprimido antes de dormir"] },
'topiramato 50mg - inicio': { uso: "USO ORAL E CONTÍNUO", medicamento:
"Topiramato (Amato) 25mg", quantidade: "120 comprimidos", instrucoes:
["Tome 1 comprimido antes de dormir, por 7 dias", "Após 7 dias, passe a
tomar 2 comprimidos antes de dormir, todas as noites"] }, 'topiramato
50mg 0-0-1': { uso: "USO ORAL E CONTÍNUO", medicamento: "Topiramato
(Amato) 50mg", quantidade: "60 comprimidos", instrucoes: ["Tome 1
comprimido antes de dormir"] }, 'duloxetina 30mg 1-0-0': { uso: "USO
ORAL E CONTÍNUO", medicamento: "Duloxetina (Cymbalta / Velija) 30mg",
quantidade: "60 cápsulas", instrucoes: ["Tome 1 cápsula após o café da
manhã"] }, 'duloxetina 60mg 1-0-0': { uso: "USO ORAL E CONTÍNUO",
medicamento: "Duloxetina (Cymbalta / Velija) 60mg", quantidade: "60
cápsulas", instrucoes: ["Tome 1 cápsula após o café da manhã"] },
'pregabalina 25mg 0-0-1': { uso: "USO ORAL E CONTÍNUO", medicamento:
"Pregabalina (Insit) 25mg", quantidade: "60 cápsulas", instrucoes:
["Tome 1 cápsula antes de dormir"] }, 'pregabalina 50mg 0-0-1': { uso:
"USO ORAL E CONTÍNUO", medicamento: "Pregabalina (Prebictal / Insit)
50mg", quantidade: "60 cápsulas", instrucoes: ["Tome 1 cápsula antes de
dormir"] }, 'pregabalina 75mg 0-0-1': { uso: "USO ORAL E CONTÍNUO",
medicamento: "Pregabalina (Prebictal / Insit) 75mg", quantidade: "60
cápsulas", instrucoes: ["Tome 1 cápsula antes de dormir"] },
'pregabalina 150mg 0-0-1': { uso: "USO ORAL E CONTÍNUO", medicamento:
"Pregabalina (Prebictal / Dorene / Insit) 150mg", quantidade: "60
cápsulas", instrucoes: ["Tome 1 cápsula antes de dormir"] }, 'trazodona
25mg - inicio': { uso: "USO ORAL E CONTÍNUO", medicamento: "Trazodona
(Donaren) 50mg", quantidade: "60 comprimidos", instrucoes: ["Tome 0,5
(meio) comprimido, 30 minutos antes de dormir", "Se após 7 dias, não
apresentar melhora significativa da qualidade do sono, passe a tomar 1
comprimido, 30 minutos antes de dormir"] }, 'trazodona 50mg 0-0-1': {
uso: "USO ORAL E CONTÍNUO", medicamento: "Trazodona (Donaren) 50mg",
quantidade: "60 comprimidos", instrucoes: ["Tome 1 comprimido, 30
minutos antes de dormir"] }, 'trazodona 100mg 0-0-1': { uso: "USO ORAL E
CONTÍNUO", medicamento: "Trazodona (Donaren) 100mg", quantidade: "60
comprimidos", instrucoes: ["Tome 1 comprimido, 30 minutos antes de
dormir"] }, 'melatonina': { uso: "USO ORAL E CONTÍNUO", medicamento:
"Manipulado", quantidade: "60 cápsulas", instrucoes: ["Melatonina
5mg\nRelora 150mg\nProSleep 35mg", "Tome 1 cápsula até 1h antes de
dormir (até as 23h)"] }, 'ramelteona': { uso: "USO ORAL", medicamento:
"Ramelteona (Rahime) 8mg", quantidade: "30 comprimidos", instrucoes:
["Tome 1 comprimido, 30 minutos antes de dormir", "Não tomar mais que 30
dias"] }, 'difenidramina': { uso: "USO ORAL", medicamento:
"Difenidramina (Lenix) 50mg", quantidade: "30 comprimidos", instrucoes:
["Tome 1 comprimido, 30 minutos antes de dormir, se necessário"] },
'quetiapina 25mg 0-0-1': { uso: "USO ORAL E CONTÍNUO", medicamento:
"Quetiapina (Seroquel / Quetros) 25mg", quantidade: "60 comprimidos",
instrucoes: ["Tome 1 comprimido, antes de dormir"] }, 'quetiapina 50mg
0-0-1': { uso: "USO ORAL E CONTÍNUO", medicamento: "Quetiapina liberação
prolongada (Seroquel XRO) 50mg", quantidade: "60 comprimidos",
instrucoes: ["Tome 1 comprimido, antes de dormir"] } }
};
const DocumentTemplates = {};
DocumentTemplates.ORIENTACOES_AVC = `Dr. Eduardo Savoldi
Neurologista — CRM-PR 33191 | RQE 25506
Paciente: [Nome]
Data: [dd/mm/aaaa]
ORIENTAÇÃO MÉDICA — ACIDENTE VASCULAR CEREBRAL (AVC)
O que é o AVC
O Acidente Vascular Cerebral (AVC) ocorre quando o sangue deixa de
chegar corretamente a uma parte do cérebro.
Isso pode acontecer por dois motivos principais:
Entupimento de uma artéria (AVC isquêmico), impedindo a passagem do
sangue.
Rompimento de uma artéria (AVC hemorrágico), causando sangramento dentro
ou ao redor do cérebro.
Quando o cérebro fica sem sangue, as células cerebrais sofrem e podem
morrer rapidamente.
Como o AVC afeta as pessoas
Os efeitos do AVC variam conforme a região do cérebro afetada e a
rapidez do tratamento.
Algumas pessoas se recuperam totalmente, enquanto outras podem
apresentar sequelas, como:
Fraqueza ou paralisia em um lado do corpo
Dificuldade para falar ou compreender o que os outros dizem
Alterações na visão ou no equilíbrio
O AVC é uma das principais causas de morte e incapacidade no mundo.
Reconhecer os sinais e agir rapidamente é fundamental.
Como reconhecer um AVC
Use a palavra SAMU para lembrar dos sinais de alerta:
S — Sorria: Peça para a pessoa sorrir. O rosto está torto?
A — Abrace: Peça para levantar os dois braços. Um braço cai ou está
fraco?
M — Música (fale): Peça para repetir uma frase simples. A fala está
enrolada ou difícil de entender?
U — Urgente: Se houver qualquer um desses sinais, ligue imediatamente
192 (SAMU).
Cada minuto conta. Quanto mais rápido o atendimento, maiores as chances
de recuperação.
Como o AVC é tratado
O tratamento depende do tipo de AVC:
AVC por entupimento (isquêmico)
Uso de medicamentos que desentopem a artéria (trombolíticos), se
aplicável
Uso de medicamentos que afinam o sangue, para prevenir novos episódios
Controle rigoroso da pressão arterial, colesterol e glicose
AVC por sangramento (hemorrágico)
Controle do sangramento e da pressão arterial
Suspensão ou ajuste de medicamentos que aumentam o risco de sangramento
Cirurgia para conter o sangramento, quando indicada
O AVC pode ser evitado
Grande parte dos AVCs pode ser prevenida com cuidados adequados e
tratamento regular.
1. Uso correto dos medicamentos:
Medicamentos para controle da pressão arterial
Estatinas para reduzir o colesterol
Anticoagulantes ou aspirina, se indicados
Medicamentos para controle do diabetes
2. Mudanças no estilo de vida:
Parar de fumar
Praticar atividade física regularmente (pelo menos 30 minutos na maioria
dos dias)
Manter o peso dentro da faixa saudável
Alimentar-se de forma equilibrada, com frutas, verduras e produtos com
baixo teor de gordura
Reduzir o consumo de sal e álcool
Orientação final
O AVC é uma emergência médica.
Reconhecer os sinais e procurar atendimento imediato pode salvar vidas e
reduzir as sequelas.
Após um AVC, o acompanhamento médico e a reabilitação são fundamentais
para a recuperação e qualidade de vida.
`;
DocumentTemplates.ORIENTACOES_CEFALEIA = `Dr. Eduardo Savoldi
Neurologista — CRM-PR 33191 | RQE 25506
Paciente: [Nome]
Data: [dd/mm/aaaa]
ORIENTAÇÃO MÉDICA — DOR DE CABEÇA
Dores de cabeça são comuns e chatas, mas existem maneiras de aliviar o
desconforto.
Existem dois tipos principais: tensional e enxaqueca. A dor de cabeça
tensional causa pressão ou aperto em ambos os lados da cabeça, como uma
faixa apertada. A enxaqueca começa leve e piora, afetando geralmente um
lado da cabeça. Pode vir acompanhada de náuseas, vômitos ou
sensibilidade à luz e ao som.
Para aliviar a dor:
* Medicamentos: Siga as orientações do seu médico. Se a dor persistir,
procure um profissional de saúde.
* Ambiente: Descansar em um lugar fresco, escuro e silencioso ajuda,
principalmente para enxaqueca.
Procure um médico com urgência se:
* A dor começar de repente, ficar forte rapidamente ou for a pior que
você já sentiu.
* Você tiver febre ou rigidez no pescoço junto com a dor.
* Sentir confusão mental, desmaiar ou ter convulsões.
* A dor começar após esforço físico intenso ou pequena lesão.
* Você começar a ter dores de cabeça novas, principalmente se estiver
grávida ou com mais de 40 anos.
Procure um médico se tiver fraqueza, dormência ou dificuldade para
enxergar (mesmo que pareçam causados por enxaqueca), ou se as dores de
cabeça forem frequentes ou fortes. O tratamento depende da causa. Se
forem frequentes, procure acompanhamento médico. Evite o uso excessivo
de analgésicos sem orientação.
Dores de cabeça podem ser desencadeadas por estresse, ansiedade, falta
de sono, dormir demais ou em horários irregulares, e pular refeições ou
comer pouco. Para lidar com elas:
* Relaxe com exercícios, meditação ou tempo para você mesmo.
* Mantenha uma rotina de sono regular.
* Coma regularmente e de forma balanceada.
Alimentos e Bebidas:
* Sódio: Alimentos ricos em sódio, como salgadinhos, refrigerantes,
conservantes e embutidos (salame, salsicha, bacon e calabresa), podem
causar retenção de líquidos e dores de cabeça. Reduza o consumo.
* Gorduras: Alimentos gordurosos, como chocolates, frituras e queijos,
também podem ser um problema. Opte por versões mais leves ou consuma com
moderação.
* Cafeína: O excesso de cafeína, presente no café, chá preto, chá mate e
energéticos, pode causar dores de cabeça. Controle o consumo e evite à
noite.
* Álcool: O álcool, principalmente em excesso, pode desencadear dores de
cabeça. Considere reduzir ou eliminar o consumo se sofrer com dores de
cabeça frequentes.
Cheiros Fortes:
* Perfumes, produtos químicos e de limpeza com cheiros fortes podem ser
irritantes e causar dores de cabeça. Evite o contato ou use versões com
fragrâncias mais suaves.
Período Menstrual e Anticoncepcionais:
* Para algumas mulheres, o período menstrual e anticoncepcionais com
estrogênio podem ser gatilhos. Converse com seu médico se perceber essa
relação.
Prevenção:
* Mantenha um calendário da dor de cabeça anotando datas, alimentação,
atividades e medicamentos usados. Isso ajuda a identificar gatilhos e
criar um plano de tratamento personalizado com seu médico.
`;
DocumentTemplates.ORIENTACOES_LOMBALGIA = `Dr. Eduardo Savoldi
Neurologista — CRM-PR 33191 | RQE 25506
Paciente: [Nome]
Data: [dd/mm/aaaa]
ORIENTAÇÃO MÉDICA — DOR NA COLUNA
A dor na coluna é muito comum e, na maioria das vezes, melhora com
movimento e fortalecimento muscular. O repouso prolongado pode piorar a
dor. A prática regular de atividades físicas é uma das principais formas
de tratamento e prevenção.
É importante lembrar que cada pessoa tem um limite diferente, e os
exercícios devem ser iniciados de forma leve e supervisionados,
principalmente no início do tratamento.
Recomenda-se pelo menos 150 minutos de atividade física por semana. Caso
não consiga, faça o tempo que for possível. O ideal é se manter ativo na
maioria dos dias, evitando exageros. Essa rotina comprovadamente ajuda a
reduzir dores crônicas e melhora a qualidade de vida.
Manter-se ativo é essencial, mas deve ser feito com segurança e
consciência. Trabalhar com orientação médica e acompanhamento de
profissionais de educação física ou fisioterapia é o melhor caminho para
fortalecer a coluna sem causar lesões.
PRINCÍPIOS GERAIS PARA EXERCÍCIOS
Comece devagar: aumente a intensidade e o tempo dos exercícios de forma
gradual.
Mantenha a postura correta: isso evita sobrecarga desnecessária na
coluna.
Respire bem: não prenda a respiração durante os movimentos.
Evite impactos fortes: saltos, corridas intensas e levantamento de peso
excessivo podem piorar a dor.
Respeite o seu corpo: se sentir dor ou desconforto, pare o exercício e
procure orientação.
EXERCÍCIOS A EVITAR
Levantamento de peso intenso, especialmente com flexão ou torção da
coluna.
Atividades de alto impacto, como corrida intensa, pular corda ou
esportes com mudanças bruscas de direção.
Abdominais tradicionais, que aumentam a pressão sobre a lombar.
Agachamentos com barra livre, se não houver técnica adequada e
supervisão.
EXEMPLOS DE EXERCÍCIOS RECOMENDADOS
1. Fortalecimento e estabilidade:
Ponte: deitado de costas, dobre os joelhos e levante o quadril,
fortalecendo glúteos e lombar.
Prancha: apoie os antebraços e pontas dos pés, mantendo o corpo reto
para fortalecer o abdômen e o tronco.
Exercícios para o abdômen e lombar: fortalecem o “core”, que é o centro
de sustentação da coluna.
2. Alongamentos e flexibilidade:
Alongamento dos músculos das pernas e costas: aliviam a tensão e
melhoram a mobilidade.
Yoga ou Pilates: fortalecem o tronco, melhoram a postura e a
flexibilidade, além de reduzirem o estresse.
3. Exercícios aeróbicos de baixo impacto:
Caminhada: simples e segura, melhora a circulação e ajuda a manter a
mobilidade.
Natação: a água reduz a pressão sobre as articulações e a coluna.
Bicicleta ergométrica: fortalece as pernas com pouco impacto.
Corrida leve: pode ser feita com cuidado, evitando impactos e terrenos
irregulares.
ORIENTAÇÃO FINAL
A chave para melhorar a dor na coluna é movimentar-se com cuidado e
regularidade. Exercícios bem orientados fortalecem os músculos, aumentam
a flexibilidade e reduzem a dor.
Evite permanecer muito tempo parado ou deitado. Pequenas mudanças
diárias — como alongar-se, caminhar e manter boa postura — fazem grande
diferença na recuperação e na prevenção de novas crises.
`;
const DocumentStrategies = {
'Atestado': (doc, nomePaciente, diagnosticos, assinatura, dataAtual,
periodoAtual) => {
const titulo = 'ATESTADO MÉDICO';
const conteudo = `ATESTADO MÉDICO\nAtesto, para os devidos fins, que
${nomePaciente} necessita de ${doc.detalhe.replace(' dias', '') ||
'[Nº]'} dias de afastamento de suas atividades laborais a partir desta
data, por motivos de saúde.\nCID: ${diagnosticos.match(/\((.*?)\)/)?.[1]
|| "[CID]"}\n\nCuritiba, ${dataAtual}.`;
return { titulo, conteudo: conteudo + assinatura };
},
'Declaração': (doc, nomePaciente, diagnosticos, assinatura, dataAtual,
periodoAtual) => {
let titulo = 'DECLARAÇÃO DE COMPARECIMENTO';
let conteudo = `DECLARAÇÃO DE COMPARECIMENTO\nDeclaro que
${nomePaciente} esteve em consulta médica nesta data, no período da
${periodoAtual}.\n\nCuritiba, ${dataAtual}.`;
if (doc.detalhe) {
titulo = 'DECLARAÇÃO DE ACOMPANHANTE';
conteudo = `DECLARAÇÃO DE ACOMPANHANTE\nDeclaro que
${toTitleCase(doc.detalhe)} esteve presente nesta data, no período da
${periodoAtual}, acompanhando o(a) paciente ${nomePaciente} em consulta
médica.\n\nCuritiba, ${dataAtual}.`;
}
return { titulo, conteudo: conteudo + assinatura };
},
'Laudo': async (doc, nomePaciente, diagnosticos, assinatura, dataAtual,
periodoAtual, dados, renderFieldFn) => {
const LaudoSubStrategies = {
'Incapacidade': async (consulta, nomePaciente, diagnosticos, assinatura,
renderFieldFn, dataAtual) => {
const cabecalho = `Paciente: ${nomePaciente}\nData: ${dataAtual}\n`;
const diagnosticosComCods = await Promise.all(
(consulta.diagnosticos || []).map(async (diag) => {
const nomeDiagnostico = diag.texto.replace(/\(.*\)/, "").trim();
if (!nomeDiagnostico) return null;
const cods = await gerarCodsComIA(nomeDiagnostico);
return `${nomeDiagnostico} (CID-10: ${cods.cid10} / CID-11:
${cods.cid11})`;
})
);
const diagnosticosFormatados =
diagnosticosComCods.filter(Boolean).join('; ');
const corpo = `LAUDO MÉDICO - INCAPACIDADE\n${cabecalho}\nAtesto, para
os devidos fins, que ${nomePaciente} apresenta diagnóstico de:
${diagnosticosFormatados || '[Nome da condição clínica]'}.\n\nTrata-se
de condição médica que cursa com comprometimento funcional, resultando
em limitação para atividades laborativas e da vida diária.\n\nO paciente
necessita de acompanhamento médico regular e, quando indicado, suporte
terapêutico multiprofissional.\n\nCuritiba, ${dataAtual}.`;
return corpo + assinatura;
},
'Concurso': (consulta, nomePaciente, diagnosticos, assinatura,
renderFieldFn, dataAtual) => {
const laudoContent = `LAUDO NEUROLÓGICO PARA CONCURSO/ADMISSÃO\nAtesto,
para os devidos fins, que ${nomePaciente}:\n- Esteve em consulta com
neurologista nesta data.\n- Não apresenta histórico pessoal ou familiar
de doença neurológica incapacitante.\n- Não apresenta alterações ao
exame neurológico atual.\n\nConclusão: Ausência de patologia neurológica
que impeça o exercício do cargo, estando APTO(A) a exercer o cargo
proposto.\n`;
return laudoContent + assinatura;
},
'Neurodivergente': (consulta, nomePaciente, diagnosticos, assinatura,
renderFieldFn, dataAtual) => {
const isTea = /TEA|Transtorno do Espectro Autista/i.test(diagnosticos);
const leiTea = isTea ? " e Lei nº 12.764/2012 (Política Nacional de
Proteção dos Direitos da Pessoa com Transtorno do Espectro Autista)" :
"";
const encaminhamentosArray = consulta.conduta.encaminhamento?.map(e =>
e.texto).filter(Boolean);
let linhaEncaminhamentos = encaminhamentosArray?.length ? `\n- Possui
indicação de terapias com: ${encaminhamentosArray.join(", ")}` : "";
const medicamentosPrescritos =
consulta.conduta.terapiaMedicamentosa?.map(e => e.texto.split('
').slice(0, 2).join(' ')).filter(Boolean);
const linhaMedicamentos = medicamentosPrescritos.length > 0 ? `Está em
uso atual dos medicamentos: ${medicamentosPrescritos.join(", ")}.` :
"Não faz uso de medicações no momento.";
const cabecalho = `Paciente: ${nomePaciente}\nData: ${dataAtual}\n`;
const corpo = `LAUDO MÉDICO\n${cabecalho}Declaro, para os devidos fins,
que ${nomePaciente} apresenta o(s) diagnóstico(s):\n${diagnosticos}\n\n-
${linhaMedicamentos}${linhaEncaminhamentos}\n- Sugere-se também a
inclusão do(a) paciente em programa educacional regular, com suporte
pedagógico e terapêutico adequados, conforme suas necessidades
específicas. Conforme o art. 2º da Lei nº 13.146/2015 (Lei Brasileira de
Inclusão da Pessoa com Deficiência)${leiTea}.\n`;
return corpo + assinatura;
},
'Diagnóstico': (consulta, nomePaciente, diagnosticos, assinatura,
renderFieldFn, dataAtual) => {
const medicamentosPrescritos = consulta.conduta?.terapiaMedicamentosa ||
[];
const medicamentosTexto = medicamentosPrescritos.length > 0
? `Está em uso atual do(s) medicamento(s):
${medicamentosPrescritos.map(med => med.texto.trim()).join(', ')}`
: "Não faz uso de medicação no momento";
const corpo = `LAUDO MÉDICO\n\nDeclaro, para os devidos fins, que
${nomePaciente} apresenta o(s) diagnóstico(s):\n-
${diagnosticos}\n\n${medicamentosTexto}.\n`;
return corpo + assinatura;
}
};
const subStrategy = LaudoSubStrategies[doc.detalhe];
const titulo = `LAUDO - ${doc.detalhe.toUpperCase()}`;
const conteudo = subStrategy ? await subStrategy(dados, nomePaciente,
diagnosticos, assinatura, renderFieldFn, dataAtual) : `LAUDO -
${doc.detalhe.toUpperCase()}\n\nModelo não encontrado.`;
return { titulo, conteudo };
},
'Orientações': (doc, nomePaciente, diagnosticos, assinatura, dataAtual,
periodoAtual) => {
const templateKey = `ORIENTACOES_${doc.detalhe.toUpperCase()}`;
let conteudo = DocumentTemplates[templateKey] || 'Modelo de orientação
não encontrado.';
if (['AVC', 'Cefaleia', 'Lombalgia'].includes(doc.detalhe)) {
conteudo = conteudo.replace('[Nome]',
nomePaciente).replace('[dd/mm/aaaa]', dataAtual);
}
const titulo = `ORIENTAÇÕES - ${doc.detalhe.toUpperCase()}`;
return { titulo, conteudo: conteudo + assinatura };
},
'Psicotrópico': (doc, nomePaciente, diagnosticos, assinatura, dataAtual,
periodoAtual, dados) => {
const titulo = 'DECLARAÇÃO DE USO DE PSICOTRÓPICO';
const medInfo = doc.detalhe; // { medName, posology }
const medNome = medInfo.medName || '[Medicamento]';
const posologiaTexto = medInfo.posology ?
_parsePosologiaCode(medInfo.posology, 'comprimido/cápsula') : '[Dosagem
e frequência conforme prescrição]';
let condicaoClinica = '[Condição Clínica (TDAH, Narcolepsia)]';
let cidCodes = 'CID-10: [código] / CID-11: [código]';
const allDiagsText = dados.diagnosticos.map(d => d.texto).join(' ');
if (/tdah|déficit de atenção/i.test(allDiagsText)) {
condicaoClinica = 'Transtorno do Déficit de Atenção e Hiperatividade';
const tdahDiag = dados.diagnosticos.find(d => /tdah|déficit de
atenção/i.test(d.texto));
const cidMatch = tdahDiag?.texto.match(/\((.*?)\)/);
cidCodes = cidMatch ? `(CID-10: ${cidMatch[1]})` : '(CID-10: F90.0)';
} else if (/narcolepsia/i.test(allDiagsText)) {
condicaoClinica = 'Narcolepsia';
const narcoDiag = dados.diagnosticos.find(d =>
/narcolepsia/i.test(d.texto));
const cidMatch = narcoDiag?.texto.match(/\((.*?)\)/);
cidCodes = cidMatch ? `(CID-10: ${cidMatch[1]})` : '(CID-10: G47.4)';
}
const conteudo = `DECLARAÇÃO\n\nDeclaro, para os devidos fins, que o(a)
${nomePaciente} faz uso contínuo e supervisionado do medicamento
${medNome}, prescrito para tratamento de ${condicaoClinica}
${cidCodes}.\n\nO uso é de caráter prolongado, conforme acompanhamento
médico, sendo necessária a manutenção terapêutica sem interrupções, na
posologia:\n${posologiaTexto}, com previsão de uso contínuo e
necessidade de fornecimento de 2 caixas.\n\nEsta declaração visa
facilitar o fornecimento regular do medicamento controlado de uso
prolongado, conforme normas sanitárias vigentes (RDC nº 357/2020 –
ANVISA).\n\nCuritiba, ${dataAtual}.`;
return { titulo, conteudo: conteudo + assinatura };
},
'LME': (doc, nomePaciente, diagnosticos, assinatura, dataAtual,
periodoAtual) => {
const titulo = 'LAUDO PARA SOLICITAÇÃO DE MEDICAMENTO (LME)';
const conteudo = `LAUDO PARA SOLICITAÇÃO DE MEDICAMENTO
(LME)\n\nPaciente: ${nomePaciente}\nData:
${dataAtual}\n\nDiagnóstico(s):\n- ${diagnosticos}\n\nMedicamento(s)
Solicitado(s):\n- ${doc.detalhe.split(',').join('\n- ')}\n\n[O CONTEÚDO
DETALHADO DESTE DOCUMENTO SERÁ FORNECIDO POSTERIORMENTE]`;
return { titulo, conteudo: conteudo + assinatura };
},
'default': (doc) => {
console.warn(`Estratégia não encontrada para o tipo de documento:
${doc.tipo}`);
const titulo = `DOCUMENTO - ${doc.tipo.toUpperCase()}`;
const conteudo = `Documento ${doc.tipo} sem template definido.`;
return { titulo, conteudo };
}
};
const MODELOS_COMPLETOS = {
'migraneaSemAura': { diagnosticos: [{ texto: 'Migrânea sem Aura (G43.0)'
}], historiaInicial: { texto: 'Cefaleia pulsátil, forte, unilateral, com
4-72h de duração, que piora com atividades físicas.\nAssocia-se a
náusea/vômitos, fotofobia e fonofobia.' }, exameFisico: { texto: 'Normal
no período intercrítico.' }, conduta: { terapiaMedicamentosa: [{ texto:
'Crise aguda: Analgésicos comuns, AINEs ou Triptanas.' }],
examesSolicitados: [{ texto: 'Neuroimagem não indicada em quadros
típicos com exame neurológico normal, salvo sinais de alarme.' }],
encaminhamento: [{ texto: 'Desnecessário, exceto em casos refratários ou
com sinais de alarme.' }] }},
'migraneaComAura': { diagnosticos: [{ texto: 'Migrânea com Aura (G43.1)'
}], historiaInicial: { texto: 'Cefaleia precedida ou acompanhada por
sintomas neurológicos focais transitórios (aura), como escotomas, pontos
luminosos, dormência ou dificuldade de fala.\nAura com duração de 5 a 60
minutos, seguida por cefaleia com características de migrânea sem aura.'
}, exameFisico: { texto: 'Normal no período intercrítico.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Crise aguda: Analgésicos, AINEs ou
Triptanas.\nProfilaxia: Betabloqueadores, Antidepressivos Tricíclicos,
Anticonvulsivantes (Topiramato, Divalproato), Bloqueadores de Canais de
Cálcio (Flunarizina), Anticorpos Monoclonais.' }], examesSolicitados: [{
texto: 'RM de Crânio para excluir outras causas na primeira ocorrência
da aura ou em caso de mudança no padrão.' }], encaminhamento: [{ texto:
'' }] }, },
'cefaleiaTensional': { diagnosticos: [{ texto: 'Cefaleia do Tipo
Tensional (G44.2)' }], historiaInicial: { texto: 'Cefaleia em pressão ou
aperto, de intensidade leve a moderada, bilateral, que não piora com
atividade física.\nNão associa náuseas, mas pode haver fotofobia ou
fonofobia.' }, exameFisico: { texto: 'Normal. Pode haver sensibilidade à
palpação dos músculos pericranianos.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Crise aguda: Analgésicos comuns,
AINEs.\nProfilaxia: Amitriptilina em baixas doses.' }],
examesSolicitados: [{ texto: 'Geralmente desnecessários.' }],
encaminhamento: [{ texto: 'Fisioterapia, Acupuntura, Terapia
Cognitivo-Comportamental.' }] }},
'cefaleiaCronicaDiaria': { diagnosticos: [{ texto: 'Cefaleia Crônica
Diária (G44.2)' }], historiaInicial: { texto: 'Cefaleia presente por 15
ou mais dias por mês, há mais de 3 meses.\nPode ter características de
migrânea ou tensional.\nFrequentemente associada ao uso excessivo de
analgésicos.' }, exameFisico: { texto: 'Normal.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Tratamento preventivo (Topiramato,
Amitriptilina, etc.).\nDesintoxicação supervisionada de analgésicos de
abuso.' }], examesSolicitados: [{ texto: 'RM de Crânio para excluir
causas secundárias.' }], encaminhamento: [{ texto: 'Psicoterapia,
Fisioterapia.' }] }},
'cefaleiaEmSalvas': { diagnosticos: [{ texto: 'Cefaleia em Salvas
(G44.0)' }], historiaInicial: { texto: 'Dor excruciante, unilateral, em
região orbitária, supraorbitária ou temporal, com duração de 15 a 180
minutos.\nAssocia por sinais autonômicos ipsilaterais (lacrimejamento,
congestão nasal, ptose, etc.) e agitação psicomotora.\nOcorre em
"salvas" (períodos de semanas a meses) com remissões.' }, exameFisico: {
texto: 'Normal fora das crises. Durante a crise, apresenta os sinais
autonômicos descritos.' }, conduta: { terapiaMedicamentosa: [{ texto:
'Crise aguda: Oxigênio a 100% (12-15 L/min), Sumatriptana
subcutânea.\nProfilaxia: Verapamil, Carbonato de Lítio, Corticoides
(para períodos curtos).' }], examesSolicitados: [{ texto: 'RM de Crânio
para excluir lesões hipofisárias ou outras.' }], encaminhamento: [{
texto: '' }] }},
'tag': { diagnosticos: [{ texto: 'Transtorno de Ansiedade Generalizada
(F41.1)' }], historiaInicial: { texto: 'Preocupação excessiva e
ansiedade sobre diversos eventos ou atividades, na maior parte do dia,
quase todos os dias, por pelo menos 6 meses.\nDificuldade em controlar a
preocupação.\nSintomas associados: inquietação, fadiga, dificuldade de
concentração, irritabilidade, tensão muscular, perturbações do sono.' },
exameFisico: { texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{
texto: 'ISRS (Escitalopram, Sertralina), IRSN (Venlafaxina,
Duloxetina).\nOutros: Pregabalina.\nBenzodiazepínicos (uso por curto
prazo).' }], examesSolicitados: [{ texto: '' }], encaminhamento: [{
texto: 'Psicoterapia (Terapia Cognitivo-Comportamental é a primeira
linha).' }] }},
'tdm': { diagnosticos: [{ texto: 'Transtorno Depressivo Maior (F32)' }],
historiaInicial: { texto: 'Humor deprimido e/ou anedonia (perda de
interesse ou prazer) na maior parte do dia, quase todos os dias, por
pelo menos 2 semanas.\nSintomas associados: alteração de peso/apetite,
insônia/hipersonia, agitação/retardo psicomotor, fadiga, sentimentos de
inutilidade/culpa, dificuldade de concentração, ideação suicida.' },
exameFisico: { texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{
texto: 'ISRS, IRSN, Antidepressivos Atípicos (Bupropiona, Mirtazapina).'
}], examesSolicitados: [{ texto: 'Avaliação laboratorial para excluir
causas orgânicas (TSH, Vit B12, etc.).' }], encaminhamento: [{ texto:
'Psicoterapia.' }] }},
'tab': { diagnosticos: [{ texto: 'Transtorno Afetivo Bipolar (F31)' }],
historiaInicial: { texto: 'História de pelo menos um episódio de mania
ou hipomania.\nEpisódios de depressão maior são comuns.\nEpisódio
Maníaco: período de humor anormal e persistentemente elevado, expansivo
ou irritável, com aumento de energia, durando pelo menos 1 semana, com
prejuízo funcional.\nEpisódio Hipomaníaco: semelhante à mania, mas com
duração de pelo menos 4 dias e sem prejuízo funcional acentuado.' },
exameFisico: { texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{
texto: 'Estabilizadores de Humor (Lítio, Divalproato, Lamotrigina,
Carbamazepina).\nAntipsicóticos Atípicos (Quetiapina, Olanzapina,
Risperidona).\nEvitar antidepressivos em monoterapia.' }],
examesSolicitados: [{ texto: '' }], encaminhamento: [{ texto:
'Psicoterapia, Psicoeducação.' }] }},
'tdah': { diagnosticos: [{ texto: 'Transtorno do Déficit de Atenção e
Hiperatividade (F90.0)' }], historiaInicial: { texto: 'Padrão
persistente de desatenção e/ou hiperatividade-impulsividade que
interfere no funcionamento ou desenvolvimento.\nDesatenção: dificuldade
em manter o foco, parece não ouvir, perde coisas,
desorganizado.\nHiperatividade/Impulsividade: inquietação, fala
excessiva, dificuldade em esperar a vez, interrompe os outros.\nSintomas
presentes antes dos 12 anos e em mais de um ambiente.' }, exameFisico: {
texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{ texto:
'Psicoestimulantes (Metilfenidato, Lisdexanfetamina).\nNão estimulantes
(Atomoxetina, Bupropiona).' }], examesSolicitados: [{ texto: '' }],
encaminhamento: [{ texto: 'Terapia Cognitivo-Comportamental, Treinamento
de Pais, Adaptações escolares.' }] }},
'tea': { diagnosticos: [{ texto: 'Transtorno do Espectro Autista
(F84.0)' }], historiaInicial: { texto: 'Déficits persistentes na
comunicação social e interação social em múltiplos contextos.\nPadrões
restritos e repetitivos de comportamento, interesses ou
atividades.\nSintomas presentes no período do desenvolvimento
inicial.\nCausa prejuízo clinicamente significativo no funcionamento
social, ocupacional ou outras áreas importantes.' }, exameFisico: {
texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{ texto:
'Tratamento de comorbidades (ansiedade, TDAH, irritabilidade) com
Risperidona, Aripiprazol, etc.' }], examesSolicitados: [{ texto: '' }],
encaminhamento: [{ texto: 'Terapia Ocupacional, Fonoaudiologia (ênfase
em comunicação social), Análise do Comportamento Aplicada (ABA),
Psicoterapia.' }] }},
'dislexia': { diagnosticos: [{ texto: 'Transtorno Específico da
Aprendizagem com prejuízo na leitura (F81.0)' }], historiaInicial: {
texto: 'Dificuldade na aprendizagem e no uso de habilidades acadêmicas,
persistindo por pelo menos 6 meses apesar de intervenções.\nDificuldade
na leitura de palavras de forma precisa ou fluente, dificuldade em
compreender o significado do que é lido.\nAs habilidades estão
substancialmente abaixo do esperado para a idade cronológica.' },
exameFisico: { texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{
texto: 'Não há medicação específica para dislexia. Tratar comorbidades
como TDAH.' }], examesSolicitados: [{ texto: '' }], encaminhamento: [{
texto: 'Avaliação Neuropsicológica, Fonoaudiologia, Psicopedagogia.' }]
}},
'tod': { diagnosticos: [{ texto: 'Transtorno Opositivo-Desafiador
(F91.3)' }], historiaInicial: { texto: 'Padrão de humor
raivoso/irritável, comportamento questionador/desafiante ou índole
vingativa, durando pelo menos 6 meses.\nOcorre durante a interação com
pelo menos um indivíduo que não seja um irmão.\nCausa sofrimento para o
indivíduo ou para outros em seu convívio social imediato.' },
exameFisico: { texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{
texto: 'Tratar comorbidades psiquiátricas. Não há medicação específica.'
}], examesSolicitados: [{ texto: '' }], encaminhamento: [{ texto:
'Treinamento de Pais, Terapia Familiar, Terapia Individual para a
criança/adolescente.' }] }},
'insonia': { diagnosticos: [{ texto: 'Insônia (G47.0)' }],
historiaInicial: { texto: 'Insatisfação com a quantidade ou qualidade do
sono, associada a dificuldade em iniciar o sono, manter o sono ou
despertar precoce.\nOcorre pelo menos 3 noites por semana, por pelo
menos 3 meses.\nCausa sofrimento significativo ou prejuízo no
funcionamento.' }, exameFisico: { texto: 'Normal.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Hipnóticos não-benzodiazepínicos
(Zolpidem, Zopiclona) - uso curto prazo.\nAntidepressivos sedativos
(Trazodona, Mirtazapina).\nMelatonina.' }], examesSolicitados: [{ texto:
'Polissonografia se suspeita de outro distúrbio do sono (ex: apneia).'
}], encaminhamento: [{ texto: 'Terapia Cognitivo-Comportamental para
Insônia (TCC-I), Higiene do Sono.' }] }},
'sahos': { diagnosticos: [{ texto: 'Apneia Obstrutiva do Sono (G47.3)'
}], historiaInicial: { texto: 'Roncos altos, e apneia-hipopneia (IAH) >=
5 eventos/hora na polissonografia.' }, exameFisico: { texto: 'Pode ter
IMC elevado, circunferência cervical aumentada, alterações orofaríngeas
(Mallampati).' }, conduta: { terapiaMedicamentosa: [{ texto: '' }],
examesSolicitados: [{ texto: 'Polissonografia basal.' }],
encaminhamento: [{ texto: 'CPAP (pressão positiva contínua nas vias
aéreas), perda de peso, avaliação com
Otorrinolaringologista/Bucomaxilo.' }] }},
'spi': { diagnosticos: [{ texto: 'Síndrome das Pernas Inquietas (G25.8)'
}], historiaInicial: { texto: 'Necessidade de mover as pernas,
geralmente acompanhada por sensações desconfortáveis.\nOs sintomas
pioram em repouso e à noite, e melhoram com o movimento.\nCausa impacto
significativo no sono.' }, exameFisico: { texto: 'Normal.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Agonistas dopaminérgicos (Pramipexol,
Ropinirol).\nOutros: Pregabalina.\nReposição de ferro se ferritina
sérica baixa.' }], examesSolicitados: [{ texto: 'Dosagem de ferritina,
função renal, glicemia.' }], encaminhamento: [{ texto: '' }] }},
'narcolepsia': { diagnosticos: [{ texto: 'Narcolepsia (G47.4)' }],
historiaInicial: { texto: 'Períodos recorrentes de necessidade
irresistível de dormir ou cochilos no mesmo dia.\nOcorrência de
cataplexia (perda súbita de tônus muscular desencadeada por
emoções).\nSonolência diurna excessiva.' }, exameFisico: { texto:
'Normal.' }, conduta: { terapiaMedicamentosa: [{ texto: 'Estimulantes
(Metilfenidato, Modafinila) para sonolência.\nAntidepressivos (ISRS,
IRSN) para cataplexia.' }], examesSolicitados: [{ texto:
'Polissonografia seguida de Teste de Latências Múltiplas do Sono
(TLMS).' }], encaminhamento: [{ texto: '' }] }},
'sonambulismo': { diagnosticos: [{ texto: 'Sonambulismo (F51.3)' }],
historiaInicial: { texto: 'Episódios recorrentes de se levantar da cama
durante o sono e andar, geralmente ocorrendo no primeiro terço da noite
(sono NREM).\nO indivíduo tem olhar fixo, sem expressão, e é
relativamente sem resposta aos esforços dos outros para se
comunicar.\nPode haver amnésia para o episódio.' }, exameFisico: {
texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{ texto:
'Benzodiazepínicos (Clonazepam) em casos graves ou que coloquem o
paciente em risco.' }], examesSolicitados: [{ texto: 'Polissonografia
para excluir outras condições.' }], encaminhamento: [{ texto: 'Medidas
de segurança no ambiente, higiene do sono.' }] }},
'epilepsiaFocal': { diagnosticos: [{ texto: 'Epilepsia Focal (G40.1,
G40.2)' }], historiaInicial: { texto: 'Crises que se originam em redes
limitadas a um hemisfério cerebral.\nPode ser com ou sem comprometimento
da consciência.\nAs manifestações dependem da área cerebral envolvida
(motores, sensitivos, autonômicos, psíquicos).\nPode haver generalização
secundária para uma crise tônico-clônica bilateral.' }, exameFisico: {
texto: 'Pode ser normal ou apresentar déficits focais.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Drogas antiepilépticas (DAE) de
primeira linha: Lamotrigina, Levetiracetam, Carbamazepina,
Oxcarbazepina.' }], examesSolicitados: [{ texto: 'EEG, RM de Crânio com
protocolo para epilepsia.' }], encaminhamento: [{ texto: '' }] }},
'epilepsiaGeneralizada': { diagnosticos: [{ texto: 'Epilepsia
Generalizada (G40.3)' }], historiaInicial: { texto: 'Crises que se
originam em algum ponto do cérebro, mas rapidamente envolvem redes
bilaterais.\nIncluem crises de ausência, mioclônicas, tônicas, atônicas
e tônico-clônicas.' }, exameFisico: { texto: 'Geralmente normal.' },
conduta: { terapiaMedicamentosa: [{ texto: 'DAE de primeira linha:
Divalproato de Sódio, Lamotrigina, Levetiracetam.\nEvitar Carbamazepina
e Oxcarbazepina, que podem piorar crises de ausência ou mioclônicas.'
}], examesSolicitados: [{ texto: 'EEG, RM de Crânio.' }],
encaminhamento: [{ texto: '' }] }},
'cnep': { diagnosticos: [{ texto: 'Crises Não Epilépticas Psicogênicas
(F44.5)' }], historiaInicial: { texto: 'Episódios que se assemelham a
crises epilépticas, mas não são causados por descargas elétricas
anormais no cérebro.\nFrequentemente associados a estresse ou trauma
psicológico.\nCaracterísticas que podem sugerir CNEP: olhos fechados
durante o evento, movimentos pélvicos, choro, duração prolongada.' },
exameFisico: { texto: 'Normal.' }, conduta: { terapiaMedicamentosa: [{
texto: 'Tratar comorbidades psiquiátricas. Reduzir DAE se não houver
epilepsia concomitante.' }], examesSolicitados: [{ texto: 'Vídeo-EEG é o
padrão-ouro para o diagnóstico.' }], encaminhamento: [{ texto:
'Psicoterapia (TCC), Psiquiatria.' }] }},
'sincopeVasovagal': { diagnosticos: [{ texto: 'Síncope Vasovagal (R55)'
}], historiaInicial: { texto: 'Perda transitória da consciência devido a
uma resposta reflexa que causa bradicardia e/ou vasodilatação, levando à
hipotensão.\nDesencadeada por fatores como estresse emocional, dor,
ortostatismo prolongado.\nFrequentemente precedida por pródromos
(tontura, sudorese, náusea, visão turva).' }, exameFisico: { texto:
'Normal. Avaliar hipotensãopostural.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Geralmente não indicado. Em casos
refratários, Fludrocortisona ou Midodrina podem ser considerados.' }],
examesSolicitados: [{ texto: 'ECG. Tilt-table test em casos de dúvida
diagnóstica.' }], encaminhamento: [{ texto: 'Educação sobre gatilhos,
manobras de contrapressão, hidratação adequada.' }] }},
'vertigemCentral': { diagnosticos: [{ texto: 'Vertigem de Origem Central
(H81.4)' }], historiaInicial: { texto: 'Sensação rotatória (vertigem)
geralmente persistente e de intensidade variável.\nPode ser acompanhada
por outros sinais neurológicos: diplopia, disartria, fraqueza,
dormência.\nO nistagmo pode ser vertical ou mudar de direção.\nCausas
incluem AVC de fossa posterior, esclerose múltipla, tumores.' },
exameFisico: { texto: 'Pode apresentar nistagmo vertical, ataxia, sinais
de pares cranianos ou de tratos longos.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Tratamento da causa base.' }],
examesSolicitados: [{ texto: 'RM de Crânio, especialmente da fossa
posterior.' }], encaminhamento: [{ texto: '' }] }},
'vertigemPeriferica': { diagnosticos: [{ texto: 'Vertigem de Origem
Periférica (H81.3)' }], historiaInicial: { texto: 'Vertigem intensa,
geralmente em crises, frequentemente associada a náuseas e
vômitos.\nPode haver zumbido e perda auditiva (na Doença de Ménière).\nO
nistagmo é tipicamente horizontal ou horizontal-rotatório e
unidirecional.\nCausas incluem VPPB, Neurite Vestibular, Doença de
Ménière.' }, exameFisico: { texto: 'Manobra de Dix-Hallpike positiva na
VPPB. Teste de impulso da cabeça pode ser anormal.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Sintomáticos na crise:
anti-histamínicos (Meclizina), Benzodiazepínicos.\nManobras de
reposicionamento (Epley) para VPPB.' }], examesSolicitados: [{ texto:
'Avaliação audiológica se suspeita de Ménière.' }], encaminhamento: [{
texto: 'Otorrinolaringologista, Fisioterapia Vestibular.' }] }},
'parestesiaCutanea': { diagnosticos: [{ texto: 'Parestesia Cutânea
(R20.2)' }], historiaInicial: { texto: 'Sensação anormal, como
formigamento, queimação ou dormência, sem um estímulo
aparente.\nLocalizada em uma área específica da pele.' }, exameFisico: {
texto: 'Avaliar a sensibilidade na área afetada.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Tratamento direcionado à causa, se
identificada. Sintomáticos como Gabapentina ou Pregabalina podem ser
úteis.' }], examesSolicitados: [{ texto: 'Investigação depende da
suspeita clínica (ex: exames de sangue, estudos de condução nervosa).'
}], encaminhamento: [{ texto: '' }] }},
'neuropatiaMetabolica': { diagnosticos: [{ texto: 'Polineuropatia
Metabólica (G63)' }], historiaInicial: { texto: 'Disfunção dos nervos
periféricos associada a condições metabólicas (além do diabetes), como
hipotireoidismo, deficiências vitamínicas (B12, B1), uremia.\nOs
sintomas são geralmente simétricos, distais ("em bota e luva"),
envolvendo alterações sensitivas (dormência, dor) e/ou motoras
(fraqueza).' }, exameFisico: { texto: 'Redução da sensibilidade
vibratória e tátil, reflexos aquileus diminuídos ou ausentes.' },
conduta: { terapiaMedicamentosa: [{ texto: 'Tratamento da condição de
base (ex: reposição de T4, suplementação de vitaminas).\nControle da dor
neuropática com Antidepressivos (Duloxetina, Amitriptilina) ou
Anticonvulsivantes (Gabapentina, Pregabalina).' }], examesSolicitados:
[{ texto: 'TSH, Vitamina B12, Glicemia de jejum, Função renal.
Eletroneuromiografia.' }], encaminhamento: [{ texto: '' }] }},
'neuropatiaDiabetica': { diagnosticos: [{ texto: 'Polineuropatia
Diabética (G63.2)' }], historiaInicial: { texto: 'Complicação comum do
Diabetes Mellitus.\nA forma mais frequente é a polineuropatia
sensitivo-motora simétrica distal.\nOs sintomas iniciam nos pés com
dormência, formigamento ou dor em queimação, que podem progredir para as
pernas e mãos.' }, exameFisico: { texto: 'Perda da sensibilidade
protetora nos pés (monofilamento), diminuição da sensibilidade
vibratória, reflexos profundos reduzidos.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Controle glicêmico rigoroso é a base do
tratamento.\nDor neuropática: Duloxetina, Pregabalina, Gabapentina,
Amitriptilina.' }], examesSolicitados: [{ texto: 'Eletroneuromiografia
para confirmação e avaliação da gravidade.' }], encaminhamento: [{
texto: 'Cuidados com os pés para prevenir úlceras.' }] }},
'miasteniaGravis': { diagnosticos: [{ texto: 'Miastenia Gravis (G70.0)'
}], historiaInicial: { texto: 'Doença autoimune da junção neuromuscular
caracterizada por fraqueza muscular flutuante que piora com o uso e
melhora com o repouso.\nSintomas comuns: ptose palpebral, diplopia,
dificuldade para mastigar, engolir (disfagia), falar (disartria) e
fraqueza nos membros.' }, exameFisico: { texto: 'Fraqueza que piora com
manobras de esforço repetitivo (ex: olhar para cima por tempo prolongado
piora a ptose).' }, conduta: { terapiaMedicamentosa: [{ texto:
'Inibidores da acetilcolinesterase (Piridostigmina).\nImunossupressores
(Prednisona, Azatioprina).\nImunoglobulina intravenosa ou plasmaférese
em crises.' }], examesSolicitados: [{ texto: 'Anticorpos anti-receptor
de acetilcolina (anti-AChR), Eletroneuromiografia com teste de
estimulação repetitiva, TC de tórax (para avaliar o timo).' }],
encaminhamento: [{ texto: '' }] }},
'ela': { diagnosticos: [{ texto: 'Esclerose Lateral Amiotrófica (G12.2)'
}], historiaInicial: { texto: 'Doença neurodegenerativa progressiva que
afeta os neurônios motores superior e inferior.\nApresenta-se com
fraqueza muscular assimétrica, atrofia, fasciculações, cãibras e
espasticidade.\nPode iniciar nos membros (forma espinhal) ou com
dificuldade de fala/deglutição (forma bulbar).\nAs funções cognitivas e
sensoriais geralmente preservadas.' }, exameFisico: { texto: 'Combinação
de sinais de neurônio motor inferior (atrofia, fasciculações) e superior
(hiperreflexia, espasticidade, sinal de Babinski).' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Riluzol (pode prolongar a
sobrevida).\nEdaravone.\nTratamento sintomático para espasticidade,
salivação, etc.' }], examesSolicitados: [{ texto: 'Eletroneuromiografia
(mostra denervação ativa e crônica em múltiplos segmentos).' }],
encaminhamento: [{ texto: 'Equipe multidisciplinar (Fisioterapia,
Fonoaudiologia, Nutrição, Psicologia, Terapia Ocupacional).' }] }},
'radiculopatiaCervical': { diagnosticos: [{ texto: 'Radiculopatia
Cervical (M54.1)' }], historiaInicial: { texto: 'Dor que irradia da
região cervical para o membro superior (braço, antebraço, mão), seguindo
o trajeto de uma raiz nervosa específica (dermátomo).\nPode ser
acompanhada de parestesias (formigamento) e/ou fraqueza muscular no
território da raiz afetada.' }, exameFisico: { texto: 'Teste de Spurling
positivo. Alterações de sensibilidade, força ou reflexos correspondentes
à raiz nervosa acometida.' }, conduta: { terapiaMedicamentosa: [{ texto:
'Analgésicos, AINEs, relaxantes musculares.\nCorticoesteroides
orais.\nNeuromoduladores (Gabapentina, Pregabalina).' }],
examesSolicitados: [{ texto: 'RM de coluna cervical é o exame de
escolha.' }], encaminhamento: [{ texto: 'Fisioterapia. Avaliação com
neurocirurgia se refratário ou com déficit motor progressivo.' }] }},
'lombociatalgia': { diagnosticos: [{ texto: 'Lombociatalgia (M54.4)' }],
historiaInicial: { texto: 'Dor lombar que irradia para o membro
inferior, seguindo o trajeto do nervo ciático (geralmente L4, L5 ou
S1).\nCausa mais comum é hérnia de disco lombar comprimindo uma raiz
nervosa.' }, exameFisico: { texto: 'Teste de Lasègue (elevação da perna
estendida) positivo. Pode haver alterações sensitivas, motoras ou de
reflexos no dermátomo/miótomo correspondente.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Analgésicos, AINEs,
corticoides.\nNeuromoduladores (Gabapentina, Pregabalina).' }],
examesSolicitados: [{ texto: 'RM de coluna lombar.' }], encaminhamento:
[{ texto: 'Fisioterapia. Avaliação com neurocirurgia em casos de dor
refratária, déficit motor significativo ou síndrome da cauda equina.' }]
}},
'avciDireito': { diagnosticos: [{ texto: 'AVC Isquêmico em Hemisfério
Direito (I63)' }], historiaInicial: { texto: 'Início súbito de déficit
neurológico focal.\nHemiparesia e hipoestesia à esquerda.\nPode haver
negligência do lado esquerdo (hemineglijência) e anosognosia
(nãoreconhecimento do déficit).' }, exameFisico: { texto: 'Déficits
neurológicos correspondentes.' }, conduta: { terapiaMedicamentosa: [{
texto: 'Trombólise intravenosa (se na janela terapêutica e sem
contraindicações).\nTrombectomia mecânica (em oclusões de grandes
vasos).\nPrevenção secundária: antiplaquetários (AAS, Clopidogrel),
estatinas.' }], examesSolicitados: [{ texto: 'TC de crânio sem contraste
na emergência, seguida por AngioTC ou RM.' }], encaminhamento: [{ texto:
'Reabilitação (Fisioterapia, TO, Fono).' }] }},
'avciEsquerdo': { diagnosticos: [{ texto: 'AVC Isquêmico em Hemisfério
Esquerdo (I63)' }], historiaInicial: { texto: 'Início súbito de déficit
neurológico focal.\nHemiparesia e hipoestesia à direita.\nAfasia
(dificuldade de linguagem) é comum.' }, exameFisico: { texto: 'Déficits
neurológicos correspondentes.' }, conduta: { terapiaMedicamentosa: [{
texto: 'Idem ao AVCi Direito.' }], examesSolicitados: [{ texto: 'Idem ao
AVCi Direito.' }], encaminhamento: [{ texto: 'Reabilitação, com foco
importante em Fonoaudiologia.' }] }},
'ait': { diagnosticos: [{ texto: 'Ataque Isquêmico Transitório (G45.9)'
}], historiaInicial: { texto: 'Episódio transitório de disfunção
neurológica causada por isqueima focal, sem infarto agudo (sem lesão na
imagem).\nOs sintomas geralmente duram menos de 1 hora e revertem
completamente.\nÉ uma emergência médica, pois indica alto risco de AVC.'
}, exameFisico: { texto: 'Normal no momento da avaliação.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Iniciar profilaxia secundária com
antiplaquetários e estatinas o mais rápido possível.' }],
examesSolicitados: [{ texto: 'Investigação da etiologia é mandatória
(Doppler de carótidas, Ecocardiograma, Holter).' }], encaminhamento: [{
texto: '' }] }},
'avch': { diagnosticos: [{ texto: 'AVC Hemorrágico Intraparenquimatoso
(I61)' }], historiaInicial: { texto: 'Sangramento dentro do parênquima
cerebral.\nCausa mais comum é a hipertensão arterial.\nInício súbito de
déficit neurológico, frequentemente com cefaleia, vômitos e rebaixamento
do nível de consciência.' }, exameFisico: { texto: 'Déficits focais,
sinais de hipertensão intracraniana.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Controle rigoroso da pressão
arterial.\nReversão de anticoagulação, se aplicável.\nMedidas para
controle da pressão intracraniana.' }], examesSolicitados: [{ texto: 'TC
de crânio sem contraste.' }], encaminhamento: [{ texto: 'Avaliação com
Neurocirurgia.' }] }},
'hsa': { diagnosticos: [{ texto: 'Hemorragia Subaracnóidea (I60)' }],
historiaInicial: { texto: 'Sangramento no espaço subaracnóideo.\nCausa
mais comum é a ruptura de um aneurisma cerebral.\nCefaleia "em trovoada"
(pior da vida), de início súbito e intensidade máxima em segundos.\nPode
haver perda de consciência, rigidez de nuca.' }, exameFisico: { texto:
'Sinais meníngeos (Kernig, Brudzinski).' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Nimodipino para prevenção de
vasoespasmo.' }], examesSolicitados: [{ texto: 'TC de crânio sem
contraste. Se negativa e suspeita alta, realizar punção lombar. AngioTC
para identificar o aneurisma.' }], encaminhamento: [{ texto:
'Neurocirurgia/Neurorradiologia Intervencionista para tratamento do
aneurisma.' }] }},
'tvc': { diagnosticos: [{ texto: 'Trombose Venosa Cerebral (I67.6)' }],
historiaInicial: { texto: 'Trombose de seios venosos ou veias
cerebrais.\nApresentação clínica variável: cefaleia (sintoma mais
comum), crises epilépticas, déficits focais, papiledema.\nAssocia-se a
estados de hipercoagulabilidade (gravidez, puerpério, uso de
contraceptivos, trombofilias).' }, exameFisico: { texto: 'Pode ser
normal ou apresentar déficits focais, papiledema.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Anticoagulação (Heparina ou Enoxaparina
seguida por anticoagulante oral).' }], examesSolicitados: [{ texto:
'Angio-RM ou Angio-TC venosa.' }], encaminhamento: [{ texto: '' }] }},
'paralisiaBell': { diagnosticos: [{ texto: 'Paralisia de Bell (G51.0)'
}], historiaInicial: { texto: 'Paralisia facial periférica de início
agudo e causa idiopática.\nEnvolve toda a hemiface (incluindo a
testa).\nPode haver dor retroauricular, alterações no paladar e
hiperacusia.' }, exameFisico: { texto: 'Fraqueza dos músculos da mímica
facial em uma hemiface. Incapacidade de fechar o olho e enrugar a testa
do lado afetado.' }, conduta: { terapiaMedicamentosa: [{ texto:
'Prednisona (iniciar nas primeiras 72h).\nAntiviral (benefício
controverso, mas frequentemente usado).\nCuidados oculares (colírios
lubrificantes, oclusão do olho para dormir).' }], examesSolicitados: [{
texto: 'Geralmente não necessários em casos típicos.' }],
encaminhamento: [{ texto: 'Fisioterapia.' }] }},
'herpesZoster': { diagnosticos: [{ texto: 'Herpes Zoster (B02)' }],
historiaInicial: { texto: 'Reativação do vírus Varicela-Zoster.\nErupção
vesicular dolorosa em um dermátomo unilateral.\nA dor (neuralgia) pode
preceder as lesões cutâneas.' }, exameFisico: { texto: 'Vesículas sobre
base eritematosa em trajeto de dermátomo.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Antivirais (Aciclovir, Valaciclovir)
iniciados precocemente.\nAnalgésicos para a dor aguda.' }],
examesSolicitados: [{ texto: 'Diagnóstico é clínico.' }],
encaminhamento: [{ texto: '' }] }},
'nevralgiaPosHerpetica': { diagnosticos: [{ texto: 'Nevralgia
Pós-Herpética (G53.0)' }], historiaInicial: { texto: 'Dor que persiste
por mais de 3 meses após a resolução das lesões do Herpes Zoster.\nA dor
pode ser constante (queimação) ou intermitente (pontadas), com alodínia
(dor a estímulos não dolorosos).' }, exameFisico: { texto: 'Pode haver
cicatrizes e alterações de sensibilidade no dermátomo afetado.' },
conduta: { terapiaMedicamentosa: [{ texto: 'Primeira linha:
Antidepressivos Tricíclicos (Amitriptilina), Gabapentina/Pregabalina,
Lidocaína tópica.\nSegunda linha: Opioides.' }], examesSolicitados: [{
texto: '' }], encaminhamento: [{ texto: '' }] }},
'emrr': { diagnosticos: [{ texto: 'Esclerose Múltipla
Remitente-Recorrente (G35)' }], historiaInicial: { texto: 'Doença
desmielinizante inflamatória crônica do SNC.\nForma mais comum,
caracterizada por surtos (episódios de disfunção neurológica com
duração > 24h) com recuperação completa ou parcial.\nSintomas comuns dos
surtos: neurite óptica, mielite transversa, síndromes de tronco
cerebral.' }, exameFisico: { texto: 'Déficits neurológicos variados,
dependendo da localização das lesões (ex: diminuição da acuidade visual,
hiperreflexia, sinal de Babinski).' }, conduta: { terapiaMedicamentosa:
[{ texto: 'Tratamento do surto: Pulsoterapia com
Metilprednisolona.\nMedicamento modificador da doença
(imunomoduladores/imunossupressores): Interferons, Acetato de
Glatiramer, Teriflunomida, Dimetilfumarato, Fingolimode, Natalizumabe,
Ocrelizumabe, etc.' }], examesSolicitados: [{ texto: 'RM de crânio e
coluna (mostra lesões desmielinizantes com disseminação no tempo e no
espaço), análise do LCR (pode mostrar bandas oligoclonais).' }],
encaminhamento: [{ texto: '' }] }},
'emProgressiva': { diagnosticos: [{ texto: 'Esclerose Múltipla
Progressiva (Primária ou Secundária) (G35)' }], historiaInicial: {
texto: 'Acúmulo progressivo de incapacidade desde o início (Primária
Progressiva) ou após uma fase remitente-recorrente (Secundária
Progressiva).\nOs surtos são menos comuns ou ausentes.' }, exameFisico:
{ texto: 'Déficits neurológicos progressivos, como espasticidade e
ataxia.' }, conduta: { terapiaMedicamentosa: [{ texto: 'Ocrelizumabe é
aprovado para a forma primária progressiva. Outras opções são
limitadas.' }], examesSolicitados: [{ texto: 'RM de Crânio e Coluna.'
}], encaminhamento: [{ texto: 'Foco em reabilitação.' }] }},
'cis': { diagnosticos: [{ texto: 'Síndrome Clínica Isolada (G37.9)' }],
historiaInicial: { texto: 'Primeiro episódio clínico sugestivo de
esclerose múltipla (ex: neurite óptica), com duração de pelo menos 24
horas.\nPode ou não evoluir para EM definida.' }, exameFisico: { texto:
'Déficit focal que reverte total ou parcialmente.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Pode-se considerar iniciar tratamento
modificador da doença precocemente se a RM mostrar alto risco de
conversão para EM.' }], examesSolicitados: [{ texto: 'RM de Crânio e
avaliação oftalmológica.' }], encaminhamento: [{ texto: '' }] }},
'neuriteOptica': { diagnosticos: [{ texto: 'Neurite Óptica (H46)' }],
historiaInicial: { texto: 'Inflamação do nervo óptico.\nPerda visual
subaguda, geralmente monocular, associada a dor com a movimentação
ocular e discromatopsia (alteração na visão de cores).\nFrequentemente
associada à Esclerose Múltipla.' }, exameFisico: { texto: 'Redução da
acuidade visual, defeito pupilar aferente relativo, edema de papila ou
papila normal (neurite retrobulbar) na fundoscopia.' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Pulsoterapia com Metilprednisolona
(acelera a recuperação, mas não altera o prognóstico visual final).' }],
examesSolicitados: [{ texto: 'RM de crânio e órbitas com contraste.' }],
encaminhamento: [{ texto: '' }] }},
'nmosd': { diagnosticos: [{ texto: 'Doença do Espectro da Neuromielite
Óptica (G36.0)' }], historiaInicial: { texto: 'Doença inflamatória
autoimune que afeta preferencialmente os nervos ópticos e a medula
espinhal.\nSurtos de neurite óptica e/ou mielite transversa,
frequentemente graves.\nAssocia-se ao anticorpo anti-Aquaporina 4
(AQP4-IgG).' }, exameFisico: { texto: 'Déficits visuais graves
(cegueira) e mielopatia (fraqueza, nível sensitivo).' }, conduta: {
terapiaMedicamentosa: [{ texto: 'Tratamento do surto: Pulsoterapia,
Plasmaférese.\nPrevenção de surtos: Rituximabe, Azatioprina,
Micofenolato.' }], examesSolicitados: [{ texto: 'RM de crânio e coluna,
dosagem do AQP4-IgG no soro.' }], encaminhamento: [{ texto: '' }] }},
'mieliteTransversa': { diagnosticos: [{ texto: 'Mielite Transversa
(G37.3)' }], historiaInicial: { texto: 'Inflamação de um segmento da
medula espinhal.\nInício rápido de fraqueza nos membros inferiores,
alterações sensitivas (com nível sensitivo) e disfunção esfincteriana
(bexiga, intestino).' }, exameFisico: { texto: 'Paraparesia ou
tetraparesia, nível sensitivo, hiperreflexia abaixo do nível da lesão.'
}, conduta: { terapiaMedicamentosa: [{ texto: 'Pulsoterapia com
Metilprednisolona.' }], examesSolicitados: [{ texto: 'RM de coluna
total, análise do LCR, investigação de causas (EM, NMOSD, infecções,
etc.).' }], encaminhamento: [{ texto: '' }] }},
'tremorEssencial': { diagnosticos: [{ texto: 'Tremor Essencial (G25.0)'
}], historiaInicial: { texto: 'Tremor de ação e postural, geralmente
bilateral e simétrico, mais comum nas mãos.\nMelhora com o álcool e
piora com estresse.' }, exameFisico: { texto: 'Tremor presente durante a
ação (ex: escrever) e na postura, sem rigidez ou bradicinesia.' },
conduta: { terapiaMedicamentosa: [{ texto: 'Propranolol, Primidona.' }],
examesSolicitados: [{ texto: '' }], encaminhamento: [{ texto: ' ' }] }},
'doencaParkinson': { diagnosticos: [{ texto: 'Doença de Parkinson (G20)'
}], historiaInicial: { texto: 'Instalação lenta e progressiva de tremor
de repouso, rigidez, bradicinesia (lentidão de movimentos) e
instabilidade postural.\nSintomas geralmente iniciam de forma
assimétrica.' }, exameFisico: { texto: 'Bradicinesia, rigidez "em roda
denteada", tremor de repouso (frequentemente na forma de contar moedas),
instabilidade postural.' }, conduta: { terapiaMedicamentosa: [{ texto:
'Levodopa/Carbidopa (Prolopa), Agonistas Dopaminérgicos (Pramipexol,
Ropinirol), Inibidores da MAO-B (Rasagilina), Amantadina.' }],
examesSolicitados: [{ texto: '' }], encaminhamento: [{ texto:
'Fisioterapia motora e fonoaudiologia.' }] }},
};
const RECEITAS_ESPECIAIS_MAP = new
Map(Object.entries(StaticData.RECEITAS_ESPECIAIS));
const RECEITAS_ESPECIAIS_KEYS =
Array.from(RECEITAS_ESPECIAIS_MAP.keys());
const MEDICAMENTO_MAP = new
Map(Object.entries(StaticData.MEDICAMENTO_MAP));
const getValue = (id) => document.getElementById(id)?.value?.trim() ||
"";
const parseTextAreaToList = (id) => getValue(id).split('\n').map(t => ({
texto: t.trim() })).filter(t => t.texto);
const setValue = (id, value) => { const el =
document.getElementById(id); if (el) el.value = value || ""; };
const setTextAreaList = (id, list) => setValue(id, list?.map(item =>
item.texto).join('\n') || "");
const getToggleValue = (containerId) =>
document.querySelector(`[data-toggle-container="${containerId}"]
.btn-toggle.${UI_CLASSES.ACTIVE}`)?.dataset.value || "nao";
const setToggleValue = (containerId, value) => {
const container =
document.querySelector(`[data-toggle-container="${containerId}"]`);
if (!container) return;
container.querySelectorAll('.btn-toggle').forEach(btn =>
btn.classList.remove(UI_CLASSES.ACTIVE));
const activeBtn = container.querySelector(`[data-value="${value ||
'nao'}"]`);
if (activeBtn) activeBtn.classList.add(UI_CLASSES.ACTIVE);
const detailInput = container.querySelector('input[type="text"]');
if (detailInput) {
detailInput.classList.toggle(UI_CLASSES.HIDDEN, value !== 'sim');
if(value !== 'sim') detailInput.value = '';
}
};
const getSubmodoValue = (containerId) =>
document.querySelector(`[data-toggle-container="${containerId}"]
.btn-submodo.${UI_CLASSES.ACTIVE}`)?.dataset.value || "";
const setSubmodoValue = (containerId, value) => {
const container =
document.querySelector(`[data-toggle-container="${containerId}"]`);
if (!container) return;
container.querySelectorAll('.btn-submodo').forEach(btn =>
btn.classList.remove(UI_CLASSES.ACTIVE));
const activeBtn = container.querySelector(`[data-value="${value ||
''}"]`);
if (activeBtn) activeBtn.classList.add(UI_CLASSES.ACTIVE);
};
const getRadioValue = (name) =>
document.querySelector(`input[name="${name}"]:checked`)?.value || "";
function toTitleCase(str) {
return !str ? "" : str.toLowerCase().replace(/\b\w/g, char =>
char.toUpperCase());
}
let acronymRegex = null;
function toSentenceCase(str) {
if (!str) return "";
if (!acronymRegex) {
const acronyms = [...new Set([...Object.keys(StaticData.SIGLAS), 'TAG',
'TRM'])];
acronymRegex = new RegExp(`\\b(${acronyms.join('|')})\\b`, 'gi');
}
let lowerStr = str.toLowerCase();
let newStr = lowerStr.charAt(0).toUpperCase() + lowerStr.slice(1);
newStr = newStr.replace(/([.!?\n]\s*\w)/g, (match) =>
match.toUpperCase());
newStr = newStr.replace(acronymRegex, match => match.toUpperCase());
return newStr;
}
async function chamarAPI(prompt, systemInstruction, responseSchema =
null) {
const payload = {
contents: [{ parts: [{ text: prompt }] }],
...(systemInstruction && { systemInstruction: { parts: [{ text:
systemInstruction }] } }),
...(responseSchema && { generationConfig: { responseMimeType:
"application/json", responseSchema } }),
};
const url = AppConfig.GEMINI_API_URL + AppConfig.API_KEY;
let lastError = null;
for (let attempt = 0; attempt < 3; attempt++) {
try {
const response = await fetch(url, { method: 'POST', headers: {
'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
if (!response.ok) {
lastError = new Error(`API Error: ${response.status}`);
if ((response.status === 429 || response.status >= 500) && attempt < 2)
{
await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) *
1000 + Math.random() * 1000));
continue; // Tenta novamente
}
throw lastError; // Lança o erro se não for tentar novamente
}
const result = await response.json();
const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
if (!text) {
lastError = new Error("API response is empty or invalid.");
throw lastError;
}
return responseSchema ? JSON.parse(text) : text; // Sucesso
} catch (error) {
console.error(`API call failed attempt ${attempt + 1}:`, error);
lastError = error; // Armazena o erro (pode ser falha de rede ou o erro
lançado acima)
if (attempt < 2) {
// Se foi falha de rede (ex: fetch falhou), espera antes de tentar de
novo
await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) *
1000 + Math.random() * 1000));
}
}
}
// Se todas as tentativas falharem
showNotification(`Falha na comunicação com a IA: ${lastError?.message ||
'Erro desconhecido'}`, NotificationTypes.ERROR);
return null;
}
async function analisarTextoComIA(texto) {
if (!texto || texto.toLowerCase() === 'novo' || texto.length < 50)
return null;
const systemPrompt = `Você é um assistente médico especialista em
análise de texto de prontuários. Extraia e formate as informações do
texto fornecido. Responda APENAS com um objeto JSON seguindo o schema.
Se a informação não for encontrada, use "" ou [], conforme o tipo.
Mantenha a formatação de lista (item por linha) para Comorbidades, Uso
Atual e Conduta. Regras: Capitalize a primeira letra de cada sentença.
Mantenha abreviações médicas (ex: RM, TC, AVC, TAG) em maiúsculas. O
campo 'nome' do paciente deve ser em Title Case. Mantenha datas
DD/MM/AAAA. Não invente dados. Para Diagnóstico, retorne apenas o nome
da condição. Para 'acompanhante', decida 'sim' ou 'não'.`;
const schema = { type: "OBJECT", properties: { paciente: { type:
"OBJECT", properties: { nome: { type: "STRING" }, nascimento: { type:
"STRING" }, ocupacao: { type: "STRING" }, acompanhante: { type: "STRING"
} } }, historico: { type: "OBJECT", properties: { comorbidades: { type:
"STRING" }, cirurgiasHospitalizacoes: { type: "STRING" }, usoAtual: {
type: "STRING" }, usoPrevio: { type: "STRING" }, etilismo: { type:
"STRING" }, tabagismo: { type: "STRING" } } }, diagnosticos: { type:
"STRING" }, complementares: { type: "STRING" }, exameFisico: { type:
"STRING" }, atual: { type: "STRING" }, conduta: { type: "OBJECT",
properties: { terapiaMedicamentosa: { type: "STRING" },
examesSolicitados: { type: "STRING" }, encaminhamento: { type: "STRING"
} } } }, required: ["paciente", "historico", "diagnosticos",
"complementares", "exameFisico", "atual", "conduta"] };
document.getElementById('analise-spinner')?.classList.remove(UI_CLASSES.HIDDEN);
const resultado = await chamarAPI(texto, systemPrompt, schema);
document.getElementById('analise-spinner')?.classList.add(UI_CLASSES.HIDDEN);
if (resultado) {
try {
const mapStringToArray = (str) => str ? str.split('\n').map(s =>
s.trim()).filter(Boolean).map(s => ({ texto: s })) : [];
return {
paciente: { nome: { texto: resultado.paciente?.nome || "" }, nascimento:
{ texto: resultado.paciente?.nascimento || "" }, ocupacao: { texto:
resultado.paciente?.ocupacao || "" }, acompanhante:
resultado.paciente?.acompanhante?.toLowerCase().startsWith('s') ? 'sim'
: 'nao', acompanhanteDetalhe: { texto: "" } },
diagnosticos: mapStringToArray(resultado.diagnosticos), historiaInicial:
{ texto: "" }, atual: { texto: resultado.atual || "" },
medicamentos: { usoAtual:
mapStringToArray(resultado.historico?.usoAtual), usoPrevio: { texto:
resultado.historico?.usoPrevio || "" } },
comorbidades: mapStringToArray(resultado.historico?.comorbidades),
cirurgiasHospitalizacoes: { texto:
resultado.historico?.cirurgiasHospitalizacoes || "" },
complementares: { texto: resultado.complementares || "" }, exameFisico:
{ texto: resultado.exameFisico || "" },
conduta: { terapiaMedicamentosa:
mapStringToArray(resultado.conduta?.terapiaMedicamentosa),
examesSolicitados:
mapStringToArray(resultado.conduta?.examesSolicitados), encaminhamento:
mapStringToArray(resultado.conduta?.encaminhamento), documentos: [] },
habitos: { etilismo:
resultado.historico?.etilismo?.toLowerCase().startsWith('s') ? 'sim' :
'nao', etilismoDetalhe: { texto: "" }, tabagismo:
resultado.historico?.tabagismo?.toLowerCase().startsWith('s') ? 'sim' :
'nao', tabagismoDetalhe: { texto: "" } },
};
} catch (parseError) {
console.error("Erro ao processar dados extraídos pela IA:", parseError,
"Dados recebidos:", resultado);
showNotification('Erro ao processar a resposta da IA.',
NotificationTypes.ERROR); return null;
}
}
return null;
}
async function gerarCodsComIA(diagnostico) {
const cacheKey = diagnostico.toLowerCase().trim();
if (AppState.cidCache.has(cacheKey)) return
AppState.cidCache.get(cacheKey);
const systemPrompt = `Para o diagnóstico "${diagnostico}", retorne
APENAS um objeto JSON { "cid10": "CODIGO_CID10", "cid11": "CODIGO_CID11"
}. Use "[CÓDIGO]" se incerto. Sem explicações.`;
const schema = { type: "OBJECT", properties: { cid10: { type: "STRING"
}, cid11: { type: "STRING" } }, required: ["cid10", "cid11"] };
const resultado = await chamarAPI(diagnostico, systemPrompt, schema);
const finalResult = resultado || { cid10: "[CÓDIGO]", cid11: "[CÓDIGO]"
};
AppState.cidCache.set(cacheKey, finalResult);
return finalResult;
}
function calcularIdade(dataNasc) {
if (!dataNasc) return null;
const parts = dataNasc.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
if (!parts) return null;
const [_, dia, mes, ano] = parts.map(Number);
if (ano < 1900 || ano > new Date().getFullYear() || mes < 1 || mes > 12
|| dia < 1 || dia > 31) return null;
const dataNascimento = new Date(ano, mes - 1, dia);
if (isNaN(dataNascimento.getTime()) || dataNascimento.getDate() !== dia
|| dataNascimento.getMonth() !== mes - 1 || dataNascimento.getFullYear()
!== ano) return null;
const hoje = new Date(); let idade = hoje.getFullYear() -
dataNascimento.getFullYear();
const mesAtual = hoje.getMonth(); const mesNascimento =
dataNascimento.getMonth();
if (mesAtual < mesNascimento || (mesAtual === mesNascimento &&
hoje.getDate() < dataNascimento.getDate())) { idade--; }
return idade >= 0 ? idade : null;
}
function getFormattedDate(timestamp = Date.now()) { return (new
Date(timestamp)).toLocaleDateString("pt-BR"); }
function getPeriodoDoDia() { const hora = new Date().getHours(); if
(hora < 12) return 'MANHÃ'; if (hora < 18) return 'TARDE'; return
'NOITE'; }
function saveDataToLocal(key, data) { try { localStorage.setItem(key,
JSON.stringify(data)); } catch (e) { console.error(`Falha ao salvar
dados em ${key}:`, e); showNotification('Erro ao salvar dados locais.',
NotificationTypes.ERROR); } }
function loadDataFromLocal(key) { try { const data =
localStorage.getItem(key); return data ? JSON.parse(data) : null; }
catch (e) { console.error(`Falha ao carregar dados de ${key}:`, e);
showNotification('Erro ao carregar dados locais.',
NotificationTypes.ERROR); return null; } }
function debounce(func, timeout = 300) { let timer; return (...args) =>
{ clearTimeout(timer); timer = setTimeout(() => { func.apply(this,
args); }, timeout); }; }
function autoResizeTextarea(el) { if(el) { el.style.height = 'auto';
el.style.height = `${el.scrollHeight}px`; } }
async function copyTextToClipboard(text) {
if (!text) { showNotification('Nada para copiar.',
NotificationTypes.INFO); return false; }
try {
if (navigator.clipboard && window.isSecureContext) {
await navigator.clipboard.writeText(text); showNotification('Texto
copiado!', NotificationTypes.SUCCESS); return true;
} else { return copyFallback(text); }
} catch (err) { return copyFallback(text); }
}
function copyFallback(text) {
const textArea = document.createElement("textarea"); textArea.value =
text;
textArea.style.position = "fixed"; textArea.style.left = "-9999px";
document.body.appendChild(textArea); textArea.focus();
textArea.select();
let success = false;
try { success = document.execCommand('copy'); showNotification(success ?
'Texto copiado (fallback)!' : 'Falha ao copiar (fallback).', success ?
NotificationTypes.SUCCESS : NotificationTypes.ERROR);
} catch (err) { console.error('Erro no fallback de cópia:', err);
showNotification('Falha crítica ao copiar.', NotificationTypes.ERROR); }
finally { document.body.removeChild(textArea); }
return success;
}
function printElementContent(elementId, title) {
const contentElement = document.getElementById(elementId);
if (!contentElement || !contentElement.innerHTML.trim()) {
showNotification(`Conteúdo de #${elementId} vazio ou não encontrado para
impressão.`, NotificationTypes.WARNING); return; }
const contentHTML = contentElement.innerHTML;
const printWindow = window.open('', '', 'height=800,width=800');
if (!printWindow) { showNotification('Não foi possível abrir a janela de
impressão. Verifique bloqueadores de pop-up.', NotificationTypes.ERROR);
return; }
printWindow.document.write(`<html><head><title>${title}</title><style>body{font-family:Arial,sans-serif;margin:20px;font-size:12px}.info-card{background-color:#f9fafb;border:1px
solid
#e5e7eb;border-radius:8px;padding:12px;margin-bottom:15px;page-break-inside:avoid}.text-center{text-align:center}.mb-2{margin-bottom:8px}.font-semibold{font-weight:600}.text-xs{font-size:10px}.text-sm{font-size:12px}.mb-1{margin-bottom:4px}.list-disc{list-style-type:disc}.list-inside{list-style-position:inside}.ml-4{margin-left:16px}.mt-2{margin-top:8px}.text-right{text-align:right}pre,.preview-output{white-space:pre-wrap;font-family:monospace;background-color:#f9fafb;font-size:12px;line-height:1.6;color:#374151;padding:6px;border-radius:6px;border:1px
solid
#e5e7eb}h4{font-size:14px;margin-bottom:8px}.btn,#btn-imprimir-receitas,#btn-copiar-todas-receitas,#btn-imprimir-documentos,#btn-copiar-todos-documentos,#btn-lme-geral{display:none!important}</style></head><body><h2>${title}</h2>${contentHTML}</body></html>`);
printWindow.document.close(); printWindow.focus();
setTimeout(() => { try { printWindow.print(); printWindow.close(); }
catch (e) { console.error("Erro ao imprimir:", e); } }, 250);
}
function deduplicarTexto(textoBase, textoNovo) {
if (!textoBase || !textoNovo) return textoNovo || '';
const linhasBase = new Set( textoBase.split('\n').map(l =>
l.trim().toLowerCase()).filter(l => l.length > 5) );
return textoNovo.split('\n').map(l => l.trim()).filter(l => l.length <=
5 || !linhasBase.has(l.toLowerCase())).join('\n');
}
function getDadosPacientePadrao() {
return {
id: null, modoConsulta: "consultorio", subModoConsulta: "", paciente: {
nome: { texto: "" }, nascimento: { texto: "" }, acompanhante: "nao",
ocupacao: { texto: "" }, acompanhanteDetalhe: { texto: "" } },
diagnosticos: [], historiaInicial: { texto: "" }, atual: { texto: "" },
evolucaoHistorico: { texto: "" }, medicamentos: { usoAtual: [],
usoPrevio: { texto: "" } }, comorbidades: [], cirurgiasHospitalizacoes:
{ texto: "" },
complementares: { texto: "" }, exameFisico: { texto: "" }, conduta: {
terapiaMedicamentosa: [], examesSolicitados: [], encaminhamento: [],
documentos: [] }, lmeMedicamentos: {},
habitos: { etilismo: "nao", etilismoDetalhe: { texto: "" }, tabagismo:
"nao", tabagismoDetalhe: { texto: "" } }, lastUpdate: 0,
};
}
function _coletarDocumentos(data) {
const documentosManuais =
Array.from(document.getElementById('conduta-documentos-container')?.querySelectorAll('input[name="documento"]:checked')
|| []).map(checkbox => {
const tipo = checkbox.value; let detalhe = '';
switch (tipo) {
case 'Atestado': detalhe = `${getValue('atestado-dias')} dias`; break;
case 'Declaração': detalhe = getValue('declaracao-acompanhante'); break;
case 'Laudo': detalhe = getRadioValue('laudo-tipo'); break;
case 'Orientações': detalhe = getRadioValue('orientacoes-tipo'); break;
}
return { tipo, detalhe };
});
const psicotropicosRegex =
/\b(ritalina|concerta|venvanse|metilfenidato|lisdexanfetamina|stavigile|modafinila)\b/i;
const medLinhaRegex = /^(.*)\s+([\d,.-]+-[\d,.-]+-[\d,.-]+)$/;
const documentosAutomaticos = (data.conduta?.terapiaMedicamentosa || [])
.filter(med => psicotropicosRegex.test(med.texto.toLowerCase()))
.map(med => {
let medName = med.texto.trim(); let posology = '';
const matchPoso = med.texto.trim().match(medLinhaRegex);
if (matchPoso) { medName = matchPoso[1].trim(); posology =
matchPoso[2].trim().replace(/,/g, '.'); }
return { tipo: 'Psicotrópico', detalhe: { medName, posology } };
});
return [...documentosManuais, ...documentosAutomaticos];
}
function coletarDadosDoFormulario() {
const data = { ...getDadosPacientePadrao(),
...AppState.currentPatientData };
data.modoConsulta = getToggleValue('modoConsulta'); data.subModoConsulta
= getSubmodoValue('subModoConsulta'); data.paciente.nome.texto =
getValue('paciente-nome'); data.paciente.nascimento.texto =
getValue('paciente-nascimento'); data.paciente.ocupacao.texto =
getValue('paciente-ocupacao'); data.paciente.acompanhante =
getToggleValue('acompanhante'); data.paciente.acompanhanteDetalhe.texto
= getValue('paciente-acompanhante-detalhe');
data.diagnosticos = parseTextAreaToList('textarea-diagnosticos');
data.historiaInicial.texto = getValue('historia-inicial');
data.atual.texto = getValue('atual'); data.medicamentos.usoAtual =
parseTextAreaToList('textarea-medicamentos-atuais');
data.medicamentos.usoPrevio.texto =
getValue('textarea-medicamentos-previos'); data.comorbidades =
parseTextAreaToList('textarea-comorbidades');
data.cirurgiasHospitalizacoes.texto =
getValue('cirurgias-hospitalizacoes');
data.complementares.texto = getValue('textarea-complementares');
data.exameFisico.texto = getValue('exame-fisico'); data.habitos.etilismo
= getToggleValue('etilismo'); data.habitos.etilismoDetalhe.texto =
getValue('habito-etilismo-detalhe'); data.habitos.tabagismo =
getToggleValue('tabagismo'); data.habitos.tabagismoDetalhe.texto =
getValue('habito-tabagismo-detalhe');
data.conduta.terapiaMedicamentosa =
parseTextAreaToList('textarea-terapia'); data.conduta.examesSolicitados
= parseTextAreaToList('conduta-exames'); data.conduta.encaminhamento =
parseTextAreaToList('conduta-encaminhamento'); data.lmeMedicamentos =
{};
document.getElementById('receita-container')?.querySelectorAll('input[name="lme-checkbox"]').forEach(cb
=> { data.lmeMedicamentos[cb.dataset.medTexto] = cb.checked; });
data.conduta.documentos = _coletarDocumentos(data); data.id =
AppState.currentPatientId;
return data;
}
function preencherFormulario(dados) {
if (!dados) return;
AppState.isProgrammaticChange = true; AppState.currentPatientData =
dados;
setToggleValue('modoConsulta', dados.modoConsulta || 'consultorio');
setSubmodoValue('subModoConsulta', dados.subModoConsulta);
_atualizarVisibilidadeSubmodos(dados.modoConsulta || 'consultorio');
setValue('paciente-nome', dados.paciente?.nome?.texto);
setValue('paciente-nascimento', dados.paciente?.nascimento?.texto);
setValue('paciente-ocupacao', dados.paciente?.ocupacao?.texto);
setToggleValue('acompanhante', dados.paciente?.acompanhante);
setValue('paciente-acompanhante-detalhe',
dados.paciente?.acompanhanteDetalhe?.texto);
setToggleValue('etilismo', dados.habitos?.etilismo);
setValue('habito-etilismo-detalhe',
dados.habitos?.etilismoDetalhe?.texto); setToggleValue('tabagismo',
dados.habitos?.tabagismo); setValue('habito-tabagismo-detalhe',
dados.habitos?.tabagismoDetalhe?.texto);
setTextAreaList('textarea-diagnosticos', dados.diagnosticos);
setValue('historia-inicial', dados.historiaInicial?.texto);
setValue('atual', dados.atual?.texto);
setTextAreaList('textarea-medicamentos-atuais',
dados.medicamentos?.usoAtual); setValue('textarea-medicamentos-previos',
dados.medicamentos?.usoPrevio?.texto);
setTextAreaList('textarea-comorbidades', dados.comorbidades);
setValue('cirurgias-hospitalizacoes',
dados.cirurgiasHospitalizacoes?.texto);
setValue('textarea-complementares', dados.complementares?.texto);
setValue('exame-fisico', dados.exameFisico?.texto);
setTextAreaList('textarea-terapia',
dados.conduta?.terapiaMedicamentosa); setTextAreaList('conduta-exames',
dados.conduta?.examesSolicitados);
setTextAreaList('conduta-encaminhamento',
dados.conduta?.encaminhamento);
const docMap = new Map(dados.conduta?.documentos?.map(doc => [doc.tipo,
doc]) || []);
const documentosContainer =
document.getElementById('conduta-documentos-container');
documentosContainer?.querySelectorAll('input[name="documento"]').forEach(checkbox
=> {
const docData = docMap.get(checkbox.value); checkbox.checked =
!!docData; handleDocumentOptionChange(checkbox, true);
if (docData) {
if (docData.tipo === 'Atestado' && docData.detalhe)
setValue('atestado-dias', docData.detalhe.replace(' dias', ''));
else if (docData.tipo === 'Declaração' && docData.detalhe)
setValue('declaracao-acompanhante', docData.detalhe);
else if (docData.tipo === 'Laudo' && docData.detalhe) { const radio =
documentosContainer.querySelector(`input[name="laudo-tipo"][value="${docData.detalhe}"]`);
if (radio) radio.checked = true; }
else if (docData.tipo === 'Orientações' && docData.detalhe) { const
radio =
documentosContainer.querySelector(`input[name="orientacoes-tipo"][value="${docData.detalhe}"]`);
if (radio) radio.checked = true; }
}
});
document.querySelectorAll('textarea.form-input').forEach(autoResizeTextarea);
AppState.isProgrammaticChange = false;
}
const renderizarPreviews = async () => {
if (AppState.isProgrammaticChange) return;
try {
const dados = coletarDadosDoFormulario();
const evolucaoHtml = gerarEvolucao(dados); const receitasHtml =
gerarReceitas(dados); const documentosHtml = await
gerarDocumentos(dados); const orientacoesText =
_getOrientaçõesContent(dados);
const evolucaoOutput = document.getElementById('evolucao-output'); const
receitaContainer = document.getElementById('receita-container'); const
documentosOutputContainer =
document.getElementById('documentos-container'); const orientacoesOutput
= document.getElementById('orientacoes-output');
if (evolucaoOutput) evolucaoOutput.innerHTML = evolucaoHtml; if
(receitaContainer) receitaContainer.innerHTML = receitasHtml; if
(documentosOutputContainer) documentosOutputContainer.innerHTML =
documentosHtml; if (orientacoesOutput) orientacoesOutput.innerHTML =
orientacoesText.replace(/\n\n#Orientações\n/, '').trim();
} catch (error) { console.error("Erro ao renderizar prévias:", error);
showNotification("Erro ao atualizar prévias.", NotificationTypes.ERROR);
}
};
const renderizarPreviewsDebounced = debounce(renderizarPreviews, 350);
function buildCurrentEvolutionLine(dados) {
const resumoTexto = dados.atual?.texto?.trim(); if (!resumoTexto) return
'';
const condutaPartes = [dados.conduta.terapiaMedicamentosa?.length &&
'Terapia', dados.conduta.examesSolicitados?.length && 'Exames',
dados.conduta.encaminhamento?.length &&
'Encaminhamento'].filter(Boolean);
const condutaResumo = condutaPartes.join(', ') || 'Conduta';
return `- ${getFormattedDate()} - ${resumoTexto}. [${condutaResumo}]`;
}
function _renderEvolucaoCabecalho(dados, renderField) {
const nome = renderField(dados.paciente.nome, 'Paciente'); const idade =
calcularIdade(renderField(dados.paciente.nascimento)); const idadeTexto
= idade !== null ? `${idade} anos` : 'Idade N/A';
const nomeOutput = (nome === 'Paciente' && idadeTexto === 'Idade N/A') ?
'Paciente' : `${nome}, ${idadeTexto}`;
let acompanhanteTexto = 'Não'; if (dados.paciente.acompanhante ===
'sim') { const detalhe =
renderField(dados.paciente.acompanhanteDetalhe); acompanhanteTexto =
detalhe ? toTitleCase(detalhe) : 'Sim'; }
return `${nomeOutput}\n- Acompanhante: ${acompanhanteTexto}\n- Ocupação:
${renderField(dados.paciente.ocupacao, 'Não informada')}`;
}
function _renderEvolucaoDiagnosticos(dados) { return
dados.diagnosticos?.length ? `\n\n${dados.diagnosticos.map(d =>
`#${d.texto.trim()}`).join('\n')}` : `\n\n#Diagnóstico`; }
function _renderEvolucaoHistoricoGeral(dados, renderField, formatArray)
{
const comorbidadesTexto = formatArray(dados.comorbidades, 'Nega
Comorbidades'); const detalheEtilismo =
renderField(dados.habitos.etilismoDetalhe); const detalheTabagismo =
renderField(dados.habitos.tabagismoDetalhe);
const textoEtilismo = (dados.habitos.etilismo === 'sim' &&
detalheEtilismo) || 'Nega'; const textoTabagismo =
(dados.habitos.tabagismo === 'sim' && detalheTabagismo) || 'Nega';
const historicoItems = [`- ${comorbidadesTexto}`, `>
Cirurgias/Hospitalizações: ${renderField(dados.cirurgiasHospitalizacoes,
'Nega')}`, `> Etilismo: ${textoEtilismo}`, `> Tabagismo:
${textoTabagismo}`].join('\n');
return `\n\n#Histórico\n${historicoItems}`;
}
function _renderEvolucaoMedicamentos(dados, renderField, formatArray) {
const usoAtualItems = dados.medicamentos?.usoAtual; const textoUsoAtual
= usoAtualItems?.length ? `- ${formatArray(usoAtualItems, '')}` : `-
Nega uso`;
const textoUsoPrevio = `> Uso Prévio:
${renderField(dados.medicamentos?.usoPrevio, 'Nega')}`;
return `\n\n#Medicamentos\n${textoUsoAtual}\n${textoUsoPrevio}`;
}
function _renderEvolucaoConduta(dados, formatArray) {
const medicamentosList = dados.conduta?.terapiaMedicamentosa; const
medicamentosOutput = medicamentosList?.length ?
medicamentosList.map(item => `- ${item.texto.trim()}`).join('\n') : `-
Medicamentos: Sem Indicação atual`;
const examesContent = formatArray(dados.conduta?.examesSolicitados, 'Sem
indicação Atual'); const examesOutput =
examesContent.split('\n').map(line => `> Exames:
${line.trim()}`).join('\n');
const encaminhamentoContent = formatArray(dados.conduta?.encaminhamento,
'Sem indicação Atual'); const encaminhamentoOutput =
encaminhamentoContent.split('\n').map(line => `> Encaminhamento:
${line.trim()}`).join('\n');
const documentos = dados.conduta?.documentos; const documentosTexto =
documentos?.length ? documentos.map(d => `${d.tipo}${d.detalhe ? `
(${d.detalhe})` : ''}`).join(', ') : 'Não fornecidos na consulta atual';
const documentosOutput = `> Documentos: ${documentosTexto}`;
return
`\n\n#Conduta\n${medicamentosOutput}\n${examesOutput}\n${encaminhamentoOutput}\n${documentosOutput}`;
}
function _getOrientaçõesContent(dados) {
const orientacoesConsultorio = `\n\n#Orientações\n- Paciente orientado
quanto ao diagnóstico, condutas propostas e necessidade de seguimento
médico. Orientações fornecidas em linguagem acessível, com adequada
compreensão demonstrada. Reforçada a importância de buscar pronto
atendimento diante de agravamento, novos sintomas ou intercorrências.`;
const orientacoesHospital = `\n\n#Orientações\n- Paciente e acompanhante
orientados quanto ao diagnóstico, resultados de exames e condutas, em
linguagem acessível e com compreensão demonstrada.\n- Planejada alta
hospitalar breve, condicionada à estabilidade clínica e aos resultados
dos exames complementares.`;
return dados.modoConsulta === 'hospital' ? orientacoesHospital :
orientacoesConsultorio;
}
/** Converte código de posologia (ex: "1-0-0.5") em texto. */
function _parsePosologiaCode(posologiaCode, form = 'comprimido') {
if (!posologiaCode) return `Tomar ${form}(s) conforme orientação
médica`;
const parts = posologiaCode.split('-').map(p =>
parseFloat(p.replace(',', '.')));
if (parts.length !== 3 || parts.some(isNaN)) return `Tomar ${form}(s)
${posologiaCode}`;
const [manha, tarde, noite] = parts; const instrucoes = [];
const formPlural = (v) => (v > 1 || v === 0.5) ? `${form}s` : form;
const formatDose = (v) => v === 0.5 ? `0,5 (meio)` : `${v}`;
if (manha > 0) instrucoes.push(`${formatDose(manha)}
${formPlural(manha)} pela manhã`);
if (tarde > 0) instrucoes.push(`${formatDose(tarde)}
${formPlural(tarde)} pela tarde`);
if (noite > 0) instrucoes.push(`${formatDose(noite)}
${formPlural(noite)} à noite`);
if (instrucoes.length === 0) return `Não tomar ${form}(s) (verificar
posologia ${posologiaCode})`;
if (instrucoes.length === 1 && manha === 1 && tarde === 0 && noite ===
0) return `Tomar 1 ${form} após o café da manhã`;
if (instrucoes.length === 1 && manha === 0 && tarde === 0 && noite
=== 1) return `Tomar 1 ${form} antes de dormir`;
if (instrucoes.length === 1 && manha === 0.5 && tarde === 0 && noite ===
0) return `Tomar 0,5 (meio) ${form} após o café da manhã`;
if (instrucoes.length === 1 && manha === 0 && tarde === 0 && noite ===
0.5) return `Tomar 0,5 (meio) ${form} antes de dormir`;
return `Tomar ${instrucoes.join(', ')}`;
}
function gerarEvolucao(dados) {
if (!dados?.paciente) return "Aguardando dados do paciente...";
const renderField = (item, defaultValue = '') => item?.texto?.trim() ||
defaultValue;
const formatArray = (arr, neg) => arr?.length > 0 ? arr.map(i =>
i.texto.trim()).join('\n') : neg;
const historicoSalvo = renderField(dados.evolucaoHistorico); const
historiaInicialUnica = deduplicarTexto(historicoSalvo,
renderField(dados.historiaInicial));
const historiaFormatada = historiaInicialUnica ?
historiaInicialUnica.split('\n').filter(Boolean).map(p => `-
${p.trim()}`).join('\n') : '';
const linhaAtualPreview = buildCurrentEvolutionLine(dados); const
evolucaoCompleta = [historicoSalvo,
linhaAtualPreview].filter(Boolean).join('\n');
const fullText = [_renderEvolucaoCabecalho(dados, renderField),
_renderEvolucaoDiagnosticos(dados), `\n\n#História
Inicial\n${historiaFormatada || '- Sem nova história inicial para esta
consulta.'}`, `\n\n#Evolução\n${evolucaoCompleta || '- Nenhuma evolução
registrada.'}`, _renderEvolucaoHistoricoGeral(dados, renderField,
formatArray), _renderEvolucaoMedicamentos(dados, renderField,
formatArray), `\n\n#Exames Complementares\n-
${renderField(dados.complementares, 'Sem exames atuais')}`, `\n\n#Exame
Físico/Neurológico\n- ${renderField(dados.exameFisico, 'Sem
alterações')}`, _renderEvolucaoConduta(dados, formatArray)].join('');
return fullText;
}
function gerarReceitas(dados) {
const medicamentos = dados.conduta?.terapiaMedicamentosa; if
(!medicamentos?.length) { return `<p class="text-gray-500
text-sm">Nenhum medicamento na Conduta.</p>`; }
return medicamentos.flatMap(med => {
const medLower = med.texto.toLowerCase().trim(); const
receitaEspecialKey = RECEITAS_ESPECIAIS_KEYS.find(key =>
medLower.startsWith(key)); const receitaEspecialTemplate =
receitaEspecialKey ? RECEITAS_ESPECIAIS_MAP.get(receitaEspecialKey) :
null;
let receitasParaGerar = [];
if (receitaEspecialTemplate) {
if (Array.isArray(receitaEspecialTemplate)) { receitasParaGerar =
receitaEspecialTemplate.map(item => ({ uso: item.uso, medicamento:
item.medicamento, quantidade: item.quantidade, instrucoes:
item.instrucoes })); }
else { const { uso, medicamento, quantidade, instrucoes } =
receitaEspecialTemplate; receitasParaGerar.push({ uso, medicamento,
quantidade, instrucoes }); }
} else {
const fallbackRegex = /^(.*)\s+([\d,.-]+-[\d,.-]+-[\d,.-]+)$/; const
match = med.texto.trim().match(fallbackRegex);
let uso = "USO ORAL", medicamento = med.texto, quantidade = "01 caixa",
instrucoes = ["Conforme orientação médica"];
if (match) {
const nomeCompleto = match[1].trim(); const posologiaCode =
match[2].trim().replace(/,/g, '.');
const nomeCompletoLower = nomeCompleto.toLowerCase();
let medInfo = null; let ref = '', form = 'comprimido';
// Lógica de busca melhorada: iterar pelas chaves do map
for (const [key, value] of MEDICAMENTO_MAP.entries()) {
if (nomeCompletoLower.startsWith(key)) {
medInfo = value;
break;
}
}
if (typeof medInfo === 'string') ref = medInfo; else if (typeof medInfo
=== 'object') { ref = medInfo.ref; form = medInfo.form; }
medicamento = `${nomeCompleto} ${ref}`; const doses =
posologiaCode.split('-').map(Number); const totalDosesDia =
doses.reduce((a, b) => a + b, 0);
quantidade = `${Math.ceil(totalDosesDia * 60)} ${form}s`; const
instrucaoPosologia = _parsePosologiaCode(posologiaCode, form);
instrucoes = [instrucaoPosologia];
}
receitasParaGerar.push({ uso, medicamento, quantidade, instrucoes });
}
return receitasParaGerar.map(receita => {
const { uso, medicamento, quantidade, instrucoes } = receita; const
instrucoesTextoFinal = Array.isArray(instrucoes) ? instrucoes.join('\n')
: instrucoes;
const conteudoPre = `${uso}\n\n${medicamento}\nQuantidade:
${quantidade}\n${instrucoesTextoFinal}`;
const medBaseName = med.texto.split(' ')[0].toLowerCase().trim(); const
isLME = StaticData.LME_MEDICAMENTOS.has(medBaseName); const isChecked =
dados.lmeMedicamentos?.[med.texto] || false;
const lmeCheckboxHtml = isLME ? `<label class="checkbox-label absolute
top-2 right-14" style="font-size: 10px; padding: 2px 4px;
background-color: rgba(255, 255, 255, 0.8); border-radius: 4px;"><input
type="checkbox" name="lme-checkbox" data-med-texto="${med.texto}"
${isChecked ? 'checked' : ''}> LME</label>` : '';
return `<div class="info-card item-wrapper relative"><button
type="button" class="btn bg-gray-200 hover:bg-gray-300 text-gray-700
font-semibold py-0 px-2 text-xs absolute top-2 right-2
btn-copiar-individual">Copiar</button>${lmeCheckboxHtml}<pre
class="preview-output font-mono">${conteudoPre}</pre></div>`;
});
}).join('');
}
async function _renderizarDocumentoIndividual(doc, dados, nomePaciente,
diagnosticos, assinatura, renderFieldFn) {
const dataAtual = getFormattedDate(); const periodoAtual =
getPeriodoDoDia();
const strategy = DocumentStrategies[doc.tipo] ||
DocumentStrategies['default']; const resultado = await strategy(doc,
nomePaciente, diagnosticos, assinatura, dataAtual, periodoAtual, dados,
renderFieldFn);
const { titulo, conteudo } = resultado;
return `<div class="info-card item-wrapper relative"><button
type="button" class="btn bg-gray-200 hover:bg-gray-300 text-gray-700
font-semibold py-0 px-2 text-xs absolute top-2 right-2
btn-copiar-individual">Copiar</button><h4 class="font-semibold text-base
mb-1 text-center">${titulo}</h4><pre class="preview-output
font-mono">${conteudo}</pre></div>`;
}
async function gerarDocumentos(dados) {
const currentData = dados || coletarDadosDoFormulario(); const
nomePaciente = currentData.paciente.nome?.texto || '[NOME_PACIENTE]';
const assinatura = "";
const documentosDoUsuario = currentData.conduta.documentos || []; const
todosDocumentos = [...documentosDoUsuario];
const lmeMedsChecked = currentData.lmeMedicamentos ?
Object.keys(currentData.lmeMedicamentos).filter(med =>
currentData.lmeMedicamentos[med]) : [];
if (lmeMedsChecked.length > 0) { todosDocumentos.push({ tipo: 'LME',
detalhe: lmeMedsChecked.join(', ') }); }
if (todosDocumentos.length === 0) return '<p class="text-gray-500
text-sm">Nenhum documento selecionado ou gerado automaticamente.</p>';
const diagnosticos = currentData.diagnosticos?.length > 0 ?
currentData.diagnosticos.map(d => d.texto).join('\n- ') : '[Diagnóstico
não informado]';
const renderFieldFn = (item, defaultValue = '') => item?.texto?.trim()
|| defaultValue;
const docsPromises = todosDocumentos.map(doc =>
_renderizarDocumentoIndividual(doc, currentData, nomePaciente,
diagnosticos, assinatura, renderFieldFn));
const resolvedDocs = await Promise.all(docsPromises); return
resolvedDocs.join('');
}
function mergeExtractedData(currentData, extractedData, sourceText) {
return { ...extractedData,
paciente: { ...currentData.paciente, nome:
extractedData.paciente.nome?.texto ? extractedData.paciente.nome :
currentData.paciente.nome, nascimento:
extractedData.paciente.nascimento?.texto ?
extractedData.paciente.nascimento : currentData.paciente.nascimento,
ocupacao: extractedData.paciente.ocupacao?.texto ?
extractedData.paciente.ocupacao : currentData.paciente.ocupacao,
acompanhante: extractedData.paciente.acompanhante ||
currentData.paciente.acompanhante, acompanhanteDetalhe:
currentData.paciente.acompanhanteDetalhe },
habitos: { ...extractedData.habitos, etilismoDetalhe:
currentData.habitos.etilismoDetalhe, tabagismoDetalhe:
currentData.habitos.tabagismoDetalhe }, historiaInicial: { texto:
sourceText.trim() },
medicamentos: { usoAtual: extractedData.medicamentos.usoAtual.length > 0
? extractedData.medicamentos.usoAtual :
currentData.medicamentos.usoAtual, usoPrevio:
extractedData.medicamentos.usoPrevio?.texto ?
extractedData.medicamentos.usoPrevio :
currentData.medicamentos.usoPrevio },
comorbidades: extractedData.comorbidades.length > 0 ?
extractedData.comorbidades : currentData.comorbidades,
};
}
function handleCopyIndividual(targetButton) {
const wrapper = targetButton.closest('.item-wrapper'); const preElement
= wrapper?.querySelector('.preview-output');
if (preElement) { copyTextToClipboard(preElement.innerText); } else {
showNotification('Erro: Bloco de texto não encontrado.',
NotificationTypes.ERROR); }
}
/** Atualiza o indicador visual de status de sincronização/operação. */
function setSyncState(isActive, message = "Sincronizando...") {
const syncStatusElement = document.getElementById('sync-status'); const
syncStatusTextElement = document.getElementById('sync-status-text');
if (!syncStatusElement || !syncStatusTextElement) {
console.warn("Elementos de status de sincronização não encontrados.");
return; }
if (isActive) { syncStatusTextElement.textContent = message;
syncStatusElement.classList.add('show'); }
else { setTimeout(() => { syncStatusElement.classList.remove('show'); },
250); }
AppState.isSaving = isActive;
}
async function savePatientDataToFirebase(data, isMainSave = false) {
if (!AppState.userId) throw new Error("Usuário não autenticado."); if
(!data.paciente?.nome?.texto &&
AppState.currentPatientId?.startsWith('local_')) {
console.warn("Paciente novo sem nome. Não será salvo."); return null; }
let patientId = AppState.currentPatientId; let isNewPatient = false;
const pacientesCollectionPath =
`${AppConfig.FB_ROOT_COLLECTION}/${AppConfig.FIREBASE_APP_ID}/${AppConfig.FB_USERS_COLLECTION}/${AppState.userId}/${AppConfig.FB_PACIENTES_COLLECTION}`;
if (!patientId || patientId.startsWith('local_')) { const tempRef =
doc(collection(AppState.db, pacientesCollectionPath)); patientId =
tempRef.id; data.id = patientId; isNewPatient = true; }
const patientRef = doc(AppState.db, pacientesCollectionPath, patientId);
const dataToSave = { ...data, lastUpdate: serverTimestamp(),
'paciente.nome.texto_lower': data.paciente.nome.texto.toLowerCase() };
try { await setDoc(patientRef, dataToSave, { merge: true }); if
(isMainSave || isNewPatient)
saveDataToLocal(StorageKeys.LAST_PATIENT_ID, patientId); return
patientId;
} catch (error) { console.error("Erro ao salvar paciente:", error);
throw new Error(`Erro ao salvar: ${error.message}`); }
}
async function searchPatients(searchTerm) {
const searchResultsContainer =
document.getElementById('search-results-container'); const
evolutionsTodayContainer =
document.getElementById('evolutions-today-container');
if (!searchResultsContainer || !evolutionsTodayContainer) return; if
(!searchTerm) { searchResultsContainer.innerHTML = '';
evolutionsTodayContainer.classList.remove(UI_CLASSES.HIDDEN); return; }
evolutionsTodayContainer.classList.add(UI_CLASSES.HIDDEN);
searchResultsContainer.innerHTML = '<p class="text-gray-500
text-sm">Buscando...</p>';
if (!AppState.db || !AppState.userId) return
searchResultsContainer.innerHTML = `<p class="text-red-500
text-sm">Erro: Autenticação pendente.</p>`;
try {
const pacientesCollectionPath =
`${AppConfig.FB_ROOT_COLLECTION}/${AppConfig.FIREBASE_APP_ID}/${AppConfig.FB_USERS_COLLECTION}/${AppState.userId}/${AppConfig.FB_PACIENTES_COLLECTION}`;
const patientsRef = collection(AppState.db, pacientesCollectionPath);
const q = query(patientsRef, where('paciente.nome.texto_lower', '>=',
searchTerm), where('paciente.nome.texto_lower', '<=', searchTerm +
'\uf8ff'), limit(10));
const querySnapshot = await getDocs(q); if (querySnapshot.empty) return
searchResultsContainer.innerHTML = `<p class="text-gray-500
text-sm">Nenhum paciente encontrado.</p>`;
searchResultsContainer.innerHTML = '';
querySnapshot.forEach(docSnap => {
const patient = docSnap.data(); const age =
calcularIdade(patient.paciente?.nascimento?.texto); const lastDiag =
patient.diagnosticos?.[0]?.texto || 'Sem diagnóstico';
const card = document.createElement('div'); card.className = 'p-2 border
rounded-md hover:bg-gray-100 cursor-pointer'; card.dataset.patientId =
docSnap.id;
card.innerHTML = `<h4 class="font-semibold
text-sm">${patient.paciente?.nome?.texto || 'Nome Inválido'}</h4><p
class="text-xs text-gray-600">${age != null ? age + ' anos' : 'Idade
N/A'} - ${lastDiag}</p><p class="text-xs text-gray-400">Última
atualização: ${patient.lastUpdate ?
getFormattedDate(patient.lastUpdate.toMillis()) : 'N/A'}</p>`;
card.addEventListener('click', () => loadPatient(docSnap.id));
searchResultsContainer.appendChild(card);
});
} catch (error) {
console.error("Erro ao buscar pacientes:", error);
if (error.code === 'failed-precondition')
searchResultsContainer.innerHTML = `<p class="text-red-500
text-sm">Falha na busca: É necessário criar um índice no Firestore para
'paciente.nome.texto_lower'. Verifique o console (F12) para o link de
criação.</p>`;
else searchResultsContainer.innerHTML = `<p class="text-red-500
text-sm">Falha na busca: ${error.message}</p>`;
}
}
function loadPatient(patientId) {
if (!AppState.userId) return showNotification("Usuário não
autenticado.", NotificationTypes.ERROR); if
(patientId?.startsWith('local_')) return;
if (AppState.unsubscribePatientListener)
AppState.unsubscribePatientListener(); setSyncState(true,
"Carregando..."); AppState.currentPatientId = patientId;
const patientDocPath =
`${AppConfig.FB_ROOT_COLLECTION}/${AppConfig.FIREBASE_APP_ID}/${AppConfig.FB_USERS_COLLECTION}/${AppState.userId}/${AppConfig.FB_PACIENTES_COLLECTION}/${patientId}`;
const patientRef = doc(AppState.db, patientDocPath); let isFirstLoad =
true;
AppState.unsubscribePatientListener = onSnapshot(patientRef, (docSnap)
=> {
if (docSnap.metadata.hasPendingWrites) { console.log("onSnapshot:
Ignorando (hasPendingWrites=true)"); return; }
try {
if (docSnap.exists()) { const patientData = docSnap.data();
preencherFormulario(patientData); if (isFirstLoad) {
applyDefaultCollapsibleStates(false); isFirstLoad = false; }
renderizarPreviews(); }
else { console.warn(`Paciente ${patientId} não encontrado.`);
showNotification("Paciente não encontrado.", NotificationTypes.WARNING);
handleNewPatient(); isFirstLoad = true; }
} catch (error) { console.error("Erro ao processar dados do paciente:",
error); showNotification(`Erro ao atualizar dados: ${error.message}`,
NotificationTypes.ERROR); } finally { setSyncState(false); }
}, (error) => { console.error("Erro no listener Firestore:", error);
showNotification(`Erro de conexão: ${error.message}`,
NotificationTypes.ERROR); setSyncState(false); });
saveDataToLocal(StorageKeys.LAST_PATIENT_ID, patientId);
document.querySelector('[data-tab-left="consulta"]')?.click();
}
async function loadTodaysEvolutions() {
const evolutionsTodayList =
document.getElementById('evolutions-today-list'); if
(!evolutionsTodayList) return;
evolutionsTodayList.innerHTML = '<p class="text-gray-500
text-sm">Carregando evoluções de hoje...</p>';
if (!AppState.db || !AppState.userId) { evolutionsTodayList.innerHTML =
`<p class="text-red-500 text-sm">${NotificationTypes.ERROR}:
Autenticação pendente.</p>`; return; }
try {
const today = new Date(); today.setHours(0, 0, 0, 0); const
startOfDayTimestamp = Timestamp.fromDate(today);
const pacientesCollectionPath =
`${AppConfig.FB_ROOT_COLLECTION}/${AppConfig.FIREBASE_APP_ID}/${AppConfig.FB_USERS_COLLECTION}/${AppState.userId}/${AppConfig.FB_PACIENTES_COLLECTION}`;
const patientsRef = collection(AppState.db, pacientesCollectionPath);
const q = query(patientsRef, where('lastUpdate', '>=',
startOfDayTimestamp), orderBy('lastUpdate', 'desc'));
const querySnapshot = await getDocs(q); if (querySnapshot.empty) {
evolutionsTodayList.innerHTML = '<p class="text-gray-500
text-sm">Nenhuma evolução realizada hoje.</p>'; return; }
let evolutions = []; querySnapshot.forEach(docSnap => evolutions.push({
id: docSnap.id, ...docSnap.data() })); evolutionsTodayList.innerHTML =
'';
evolutions.forEach(evo => {
const card = document.createElement('div'); card.className = 'p-2
border-b flex justify-between items-center';
card.innerHTML = `<div class="cursor-pointer flex-grow"
data-patient-id="${evo.id}"><h4 class="font-semibold
text-sm">${evo.paciente?.nome?.texto || 'Paciente sem nome'}</h4><p
class="text-xs text-gray-500">Atualizado às: ${new
Date(evo.lastUpdate.toMillis()).toLocaleTimeString('pt-BR', { hour:
'2-digit', minute: '2-digit' })}</p></div><input type="checkbox"
class="visita-checkbox form-checkbox h-4 w-4 text-blue-600"
data-patient-id="${evo.id}">`;
card.querySelector('div[data-patient-id]').addEventListener('click', ()
=> loadPatient(evo.id));
card.querySelector('.visita-checkbox').addEventListener('change',
checkVisitaMedicaSelection); evolutionsTodayList.appendChild(card);
});
} catch (error) {
console.error("Erro ao carregar evoluções de hoje:", error);
if (error.code === 'failed-precondition') evolutionsTodayList.innerHTML
= `<p class="text-red-500 text-sm">Falha ao carregar: É necessário criar
um índice no Firestore para 'lastUpdate'. Verifique o console (F12) para
o link de criação.</p>`;
else evolutionsTodayList.innerHTML = `<p class="text-red-500
text-sm">Falha ao carregar: ${error.message}</p>`;
}
}
function toggleVisitaMedicaMode(event) {
const btn = event.currentTarget; const tabHistorico =
document.getElementById('tab-content-historico'); if (!tabHistorico)
return;
const isActive = btn.classList.toggle(UI_CLASSES.BTN_PRIMARY);
btn.classList.toggle(UI_CLASSES.BTN_GRAY, !isActive);
btn.classList.toggle(UI_CLASSES.BTN_GRAY_HOVER, !isActive);
btn.classList.toggle(UI_CLASSES.TEXT_GRAY, !isActive);
tabHistorico.classList.toggle('visita-medica-mode', isActive); if
(!isActive) {
tabHistorico.querySelectorAll('.visita-checkbox').forEach(cb =>
cb.checked = false);
document.getElementById('btn-gerar-visita')?.classList.add(UI_CLASSES.HIDDEN);
}
}
function checkVisitaMedicaSelection() { const anySelected =
!!document.querySelector('#evolutions-today-list
.visita-checkbox:checked');
document.getElementById('btn-gerar-visita')?.classList.toggle(UI_CLASSES.HIDDEN,
!anySelected); }
async function handleGerarVisita() {
if (AppState.isSaving) return; if (!AppState.db || !AppState.userId)
return showNotification("Autenticação pendente.",
NotificationTypes.ERROR);
const selectedIds =
Array.from(document.querySelectorAll('#evolutions-today-list
.visita-checkbox:checked')).map(cb => cb.dataset.patientId); if
(selectedIds.length === 0) return showNotification("Nenhuma evolução
selecionada.", NotificationTypes.WARNING);
setSyncState(true, "Gerando Relatório...");
try {
const collectionPath =
`${AppConfig.FB_ROOT_COLLECTION}/${AppConfig.FIREBASE_APP_ID}/${AppConfig.FB_USERS_COLLECTION}/${AppState.userId}/${AppConfig.FB_PACIENTES_COLLECTION}`;
const q = query(collection(AppState.db, collectionPath),
where(documentId(), "in", selectedIds)); const querySnapshot = await
getDocs(q);
let patientsData = []; querySnapshot.forEach(docSnap =>
patientsData.push({ id: docSnap.id, ...docSnap.data() }));
patientsData.sort((a, b) => selectedIds.indexOf(a.id) -
selectedIds.indexOf(b.id));
const combinedEvolutions = patientsData.map(patientData =>
gerarEvolucao(patientData).replace(/<mark[^>]*>|<\/mark>/g, ''));
const currentData = coletarDadosDoFormulario(); const submodoText =
currentData.subModoConsulta ?
`(${currentData.subModoConsulta.replace('sao-vicente', 'São
Vicente').replace('cruz-vermelha', 'Cruz Vermelha').replace(/^\w/, c =>
c.toUpperCase())})` : '';
const dataText = getFormattedDate(); const title = `Visita Neurologia
${submodoText} ${dataText}`;
let reportHtml = `<!DOCTYPE html><html lang="pt-BR"><head><meta
charset="UTF-8"><title>${title}</title><style>body{font-family:Arial,sans-serif;margin:20px;font-size:10pt;line-height:1.4}h1{font-size:16pt;text-align:center;margin-bottom:20px}pre{white-space:pre-wrap;word-wrap:break-word;font-family:monospace;font-size:9pt;background-color:#f9f9f9;border:1px
solid #eee;padding:10px;margin:15px
0;page-break-inside:avoid}hr{border:none;border-top:1px dashed
#ccc;margin:20px 0}@media
print{body{margin:1cm;font-size:9pt}h1{font-size:14pt}pre{font-size:8pt;padding:8px;background-color:transparent;border:none}hr{margin:15px
0}}</style></head><body><h1>${title}</h1>`;
combinedEvolutions.forEach((evolutionText, index) => { reportHtml +=
`<pre>${evolutionText.replace(/</g, "&lt;").replace(/>/g,
"&gt;")}</pre>`; if (index < combinedEvolutions.length - 1) { reportHtml
+= '<hr>'; } }); reportHtml += `</body></html>`;
const printWindow = window.open('', '_blank'); if (!printWindow) { throw
new Error('Não foi possível abrir a janela de impressão. Verifique
bloqueadores de pop-up.'); }
printWindow.document.open(); printWindow.document.write(reportHtml);
printWindow.document.close();
setTimeout(() => {
try { printWindow.focus(); printWindow.print(); showNotification('Janela
de impressão aberta. Use "Salvar como PDF" se desejar.',
NotificationTypes.SUCCESS); }
catch (printError) { console.error("Erro ao chamar print():",
printError); showNotification('Erro ao abrir a janela de impressão.',
NotificationTypes.ERROR); try { printWindow.close(); } catch (e) {} }
finally { setSyncState(false); }
}, 500);
} catch (error) { console.error("Erro ao gerar Relatório para
Impressão:", error); showNotification(`Erro ao gerar relatório:
${error.message}`, NotificationTypes.ERROR); setSyncState(false); }
}
let notificationTimer;
/** Exibe um banner de notificação. */
function showNotification(message, type = NotificationTypes.INFO) {
const banner = document.getElementById('notification-banner'); const
messageEl = document.getElementById('notification-message');
if (!banner || !messageEl) { console.warn("Elementos de notificação não
encontrados. Mensagem:", message); return; }
clearTimeout(notificationTimer); banner.classList.remove('bg-green-600',
'bg-red-600', 'bg-yellow-500', 'bg-blue-600');
switch (type) {
case NotificationTypes.SUCCESS: banner.classList.add('bg-green-600');
break; case NotificationTypes.ERROR: banner.classList.add('bg-red-600');
break;
case NotificationTypes.WARNING: banner.classList.add('bg-yellow-500');
break; case NotificationTypes.INFO: default:
banner.classList.add('bg-blue-600'); break;
}
messageEl.textContent = message; banner.classList.add('show');
notificationTimer = setTimeout(() => { banner.classList.remove('show');
}, 3000);
}
/** Salva os dados do formulário no Firebase/LocalStorage após um
pequeno atraso. */
const debouncedSave = debounce(async (triggerElement) => {
if (AppState.isSaving || AppState.isProgrammaticChange) return;
AppState.isSaving = true; setSyncState(true, "Salvando..."); const data
= coletarDadosDoFormulario();
try { const savedPatientId = await savePatientDataToFirebase(data,
true); if (savedPatientId && AppState.currentPatientId !==
savedPatientId) { AppState.currentPatientId = savedPatientId;
loadPatient(savedPatientId); } setSyncState(false);
} catch (error) { console.error("Erro no debouncedSave:", error);
showNotification(error.message, NotificationTypes.ERROR);
setSyncState(false); } AppState.isSaving = false;
}, 1000);
/** Atualiza a visibilidade dos botões de submodo (Hapvida, VITA, etc.)
*/
function _atualizarVisibilidadeSubmodos(modo) { // 'modo' is
"consultorio" or "hospital"
const container = document.getElementById('submodos-container');
if (!container) return;
const isHospital = (modo === 'hospital');
// 1. Mostra o container se for modo "hospital", esconde se for
"consultorio"
container.classList.toggle(UI_CLASSES.HIDDEN, !isHospital);
// 2. (Os botões internos já estão todos visíveis por padrão no HTML)
// 3. Limpa o submodo ativo se o container for escondido (mudou para
"Consultório")
if (!isHospital) {
const activeSubmodo =
container.querySelector(`.btn-submodo.${UI_CLASSES.ACTIVE}`);
if (activeSubmodo) {
activeSubmodo.classList.remove(UI_CLASSES.ACTIVE);
}
}
}
/** Manipula a mudança de checkboxes de Documentos (Atestado, Laudo,
etc.) */
function handleDocumentOptionChange(target, isProgrammatic = false) {
if (!target || !target.name) return;
if (target.id === 'checkbox-atestado')
document.getElementById('atestado-dias')?.classList.toggle(UI_CLASSES.HIDDEN,
!target.checked);
else if (target.id === 'checkbox-declaracao')
document.getElementById('declaracao-acompanhante')?.classList.toggle(UI_CLASSES.HIDDEN,
!target.checked);
else if (target.id === 'checkbox-laudo')
document.getElementById('laudo-opcoes')?.classList.toggle(UI_CLASSES.HIDDEN,
!target.checked);
else if (target.id === 'checkbox-orientacoes')
document.getElementById('orientacoes-opcoes')?.classList.toggle(UI_CLASSES.HIDDEN,
!target.checked);
if (!isProgrammatic) { renderizarPreviewsDebounced();
debouncedSave(target); }
}
/** Manipula a mudança dos checkboxes LME na aba Receitas. */
function handleLmeCheckboxChange(event) { if (event.target.name ===
'lme-checkbox') { renderizarPreviewsDebounced();
debouncedSave(event.target); } }
/** Aplica os estados padrão (aberto/fechado) das seções. */
function applyDefaultCollapsibleStates(isFirstConsult) {
const defaultOpenSections = ['identificacao', 'diagnosticos',
'conduta']; const defaultOpenSubsections = ['uso-atual',
'conduta-medicamento', 'comorbidades'];
document.querySelectorAll('.collapsible-header,
.collapsible-subheader').forEach(header => {
const sectionId = header.dataset.sectionId ||
header.dataset.subsectionId; const shouldBeOpen =
defaultOpenSections.includes(sectionId) ||
defaultOpenSubsections.includes(sectionId);
const content = header.nextElementSibling;
header.classList.toggle('collapsed', !shouldBeOpen); if (content &&
content.classList.contains('collapsible-content')) {
content.classList.toggle('collapsed', !shouldBeOpen); }
});
if (isFirstConsult) { const historiaHeader =
document.querySelector('[data-section-id="historia-inicial"]'); if
(historiaHeader) { historiaHeader.classList.remove('collapsed');
historiaHeader.nextElementSibling?.classList.remove('collapsed'); } }
}
/** Manipula cliques globais (tabs, botões, collapsibles). */
function handleGlobalClick(event) {
try { const target = event.target.closest('button, .collapsible-header,
.collapsible-subheader'); if (!target || target.disabled) return;
if (target.matches('[data-tab-left]')) {
const tabId = target.dataset.tabLeft;
document.querySelectorAll('[data-tab-left]').forEach(btn =>
btn.classList.remove(UI_CLASSES.ACTIVE));
target.classList.add(UI_CLASSES.ACTIVE);
document.querySelectorAll('.tab-content-left').forEach(content =>
content.classList.toggle(UI_CLASSES.ACTIVE, content.id ===
`tab-content-${tabId}`));
if (tabId === 'historico') loadTodaysEvolutions();
} else if (target.matches('[data-tab]')) {
const tabId = target.dataset.tab;
document.querySelectorAll('[data-tab]').forEach(btn =>
btn.classList.remove(UI_CLASSES.ACTIVE));
target.classList.add(UI_CLASSES.ACTIVE);
document.querySelectorAll('.tab-content').forEach(content =>
content.classList.toggle(UI_CLASSES.ACTIVE, content.id ===
`tab-content-${tabId}`));
document.getElementById('orientacoes-preview-wrapper')?.classList.toggle(UI_CLASSES.HIDDEN,
tabId !== 'evolucao');
} else if (target.matches('.collapsible-header,
.collapsible-subheader')) {
target.classList.toggle('collapsed'); const content =
target.nextElementSibling; if (content &&
content.classList.contains('collapsible-content')) {
content.classList.toggle('collapsed'); }
} else if (target.matches('.btn-toggle')) {
const container = target.closest('[data-toggle-container]'); if
(!container) return; const value = target.dataset.value;
container.querySelectorAll('.btn-toggle').forEach(btn =>
btn.classList.remove(UI_CLASSES.ACTIVE));
target.classList.add(UI_CLASSES.ACTIVE);
const detailInput = container.querySelector('input[type="text"]'); if
(detailInput) detailInput.classList.toggle(UI_CLASSES.HIDDEN, value !==
'sim');
if (container.dataset.toggleContainer === 'modoConsulta') {
_atualizarVisibilidadeSubmodos(value); // Passa o valor ("consultorio"
or "hospital")
}
renderizarPreviewsDebounced(); debouncedSave(target);
} else if (target.matches('.btn-submodo')) {
const container = target.closest('[data-toggle-container]'); if
(!container) return;
container.querySelectorAll('.btn-submodo').forEach(btn =>
btn.classList.remove(UI_CLASSES.ACTIVE));
target.classList.add(UI_CLASSES.ACTIVE);
renderizarPreviewsDebounced(); debouncedSave(target);
} else if (target.matches('.model-btn')) { handleModelClick(target); }
else if (target.id === 'btn-novo-paciente') { handleNewPatient(); } else
if (target.id === 'btn-copiar-evolucao') { handleCopyEvolucao(); } else
if (target.classList.contains('btn-copiar-individual')) {
handleCopyIndividual(target); }
} catch (error) { console.error("Erro inesperado no clique global:",
error); if (typeof showNotification === 'function') {
showNotification("Ocorreu um erro ao processar sua ação.",
NotificationTypes.ERROR); } }
}
/** Manipula inputs no formulário (resize de textareas, etc.) */
function handleFormInput(event) {
try { if (AppState.isProgrammaticChange) return; const target =
event.target; if (target.id === 'textarea-diagnosticos') return; if
(target.tagName === 'TEXTAREA') autoResizeTextarea(target);
if (target.id === 'paciente-nascimento') { AppState.isProgrammaticChange
= true; target.value = target.value.replace(/\D/g,
'').replace(/(\d{2})(\d)/, '$1/$2').replace(/(\d{2})\/(\d{2})(\d)/,
'$1/$2/$3').slice(0, 10); AppState.isProgrammaticChange = false; }
if
(target.closest('[data-toggle-container]')?.querySelector('input[type="text"]'))
{
setToggleValue(target.closest('[data-toggle-container]').dataset.toggleContainer,
'sim'); }
renderizarPreviewsDebounced(); debouncedSave(target);
} catch (error) { console.error("Erro inesperado no input do
formulário:", error); if (typeof showNotification === 'function') {
showNotification("Erro ao processar a entrada de dados.",
NotificationTypes.ERROR); } }
}
/** Manipula texto colado no campo de Informações para análise da IA. */
const handlePastedText = (event) => {
const pastedText = (event.clipboardData ||
window.clipboardData).getData('text');
if (pastedText && pastedText.trim().length > 50) {
event.preventDefault(); const target = event.target;
AppState.isProgrammaticChange = true; target.value = pastedText;
autoResizeTextarea(target); AppState.isProgrammaticChange = false;
handleInformacoesBlurAnalysisDebounced(pastedText);
}
};
/** Dispara a busca de CID após o usuário parar de digitar. */
const debouncedDiagnosisInput = debounce(async (target) => {
const diagsText = target.value.trim(); if (AppState.isProgrammaticChange
|| !diagsText) return;
const diags = diagsText.split('\n'); let needsUpdate = false;
document.getElementById('cid-spinner')?.classList.remove(UI_CLASSES.HIDDEN);
const updatedDiags = await Promise.all(diags.map(async (diag) => { if
(!diag.trim() || diag.includes('(')) return diag; const cods = await
gerarCodsComIA(diag); if (cods.cid10 !== '[CÓDIGO]') { needsUpdate =
true; return `${diag.trim()} (${cods.cid10})`; } return diag; }));
document.getElementById('cid-spinner')?.classList.add(UI_CLASSES.HIDDEN);
if (needsUpdate) { AppState.isProgrammaticChange = true; target.value =
updatedDiags.join('\n'); autoResizeTextarea(target);
AppState.isProgrammaticChange = false; renderizarPreviewsDebounced();
debouncedSave(target); }
}, 1000);
/** Aplica um modelo de diagnóstico ao formulário. */
function handleModelClick(modelButton) {
try {
const modelo = MODELOS_COMPLETOS[modelButton.dataset.modelo]; if
(!modelo) return;
const currentData = coletarDadosDoFormulario();
const existingDiags = new Set(currentData.diagnosticos.map(d =>
d.texto));
const newDiags = modelo.diagnosticos.filter(d =>
!existingDiags.has(d.texto));
// Lógica de merge melhorada (inline) para substituir placeholders
let newHistoriaInicial = currentData.historiaInicial.texto;
if (modelo.historiaInicial?.texto) {
const currentTrimmed = currentData.historiaInicial.texto.trim();
const placeholdersHistoria = ['nega', 'descrição da queixa inicial...'];
if (!currentTrimmed || placeholdersHistoria.some(p =>
currentTrimmed.toLowerCase().startsWith(p))) {
newHistoriaInicial = modelo.historiaInicial.texto;
} else {
newHistoriaInicial = (currentTrimmed + '\n' +
modelo.historiaInicial.texto).trim();
}
}
let newExameFisico = currentData.exameFisico.texto;
if (modelo.exameFisico?.texto) {
const currentTrimmed = currentData.exameFisico.texto.trim();
const placeholdersExame = ['nega', 'normal', 'vigil, orientado...'];
if (!currentTrimmed || placeholdersExame.some(p =>
currentTrimmed.toLowerCase().startsWith(p))) {
newExameFisico = modelo.exameFisico.texto;
} else {
newExameFisico = (currentTrimmed + '\n' +
modelo.exameFisico.texto).trim();
}
}
const mergedData = {
...currentData,
diagnosticos: [...currentData.diagnosticos, ...newDiags],
historiaInicial: { texto: newHistoriaInicial },
exameFisico: { texto: newExameFisico },
conduta: {
terapiaMedicamentosa: [...currentData.conduta.terapiaMedicamentosa,
...(modelo.conduta?.terapiaMedicamentosa || [])],
examesSolicitados: [...currentData.conduta.examesSolicitados,
...(modelo.conduta?.examesSolicitados || [])],
encaminhamento: [...currentData.conduta.encaminhamento,
...(modelo.conduta?.encaminhamento || [])],
documentos: currentData.conduta.documentos
}
};
preencherFormulario(mergedData);
renderizarPreviews();
debouncedSave(modelButton);
} catch (error) { console.error("Erro ao aplicar modelo:", error); if
(typeof showNotification === 'function') { showNotification("Falha ao
aplicar o modelo.", NotificationTypes.ERROR); } }
}
/** Limpa o formulário para um novo paciente. */
function handleNewPatient() {
if (AppState.unsubscribePatientListener) {
AppState.unsubscribePatientListener();
AppState.unsubscribePatientListener = null; }
const newPatientId = `local_${new Date().getTime()}`;
AppState.currentPatientId = newPatientId; const defaultData =
getDadosPacientePadrao(); defaultData.id = newPatientId;
preencherFormulario(defaultData); renderizarPreviews();
applyDefaultCollapsibleStates(true);
document.getElementById('paciente-nome')?.focus();
if (typeof showNotification === 'function') { showNotification("Pronto
para novo paciente.", NotificationTypes.INFO); }
saveDataToLocal(StorageKeys.LAST_PATIENT_ID, newPatientId);
}
/** Copia a evolução completa e salva o histórico. */
async function handleCopyEvolucao() {
const evolucaoOutput = document.getElementById('evolucao-output'); if
(!evolucaoOutput) return; const fullEvolutionText =
evolucaoOutput.innerText;
const success = await copyTextToClipboard(fullEvolutionText);
if (success) {
const currentData = coletarDadosDoFormulario(); const linhaAtual =
buildCurrentEvolutionLine(currentData); const historicoAntigo =
currentData.evolucaoHistorico?.texto || '';
const novoHistorico = [historicoAntigo,
linhaAtual].filter(Boolean).join('\n');
// CORREÇÃO: Limpa campos da consulta atual (história, atual) E a
conduta anterior.
const dataLimpa = {
...currentData,
historiaInicial: { texto: "" },
atual: { texto: "" },
evolucaoHistorico: { texto: novoHistorico },
conduta: { // Limpa a conduta da consulta que acabou de ser salva
terapiaMedicamentosa: [],
examesSolicitados: [],
encaminhamento: [],
documentos: []
},
lmeMedicamentos: {} // Limpa os checkboxes de LME
};
preencherFormulario(dataLimpa); renderizarPreviews();
debouncedSave(evolucaoOutput); showNotification('Evolução copiada e
consulta finalizada!', NotificationTypes.SUCCESS);
}
}
/** Debounce para a análise de IA do campo "Informações". */
const handleInformacoesBlurAnalysisDebounced = debounce(async (text) =>
{
const lowerText = text.toLowerCase().trim();
// 1. Lógica para "Novo"
if (lowerText === 'novo') {
showNotification("Limpando formulário...", NotificationTypes.INFO);
handleNewPatient(); // Corrigido: Chamar a função de limpar
return; // Parar a execução
}
// 2. Lógica para análise (só analisar se tiver texto suficiente)
if (text.trim().length < 50) return;
// 3. Executar Análise com IA
document.getElementById('analise-spinner')?.classList.remove(UI_CLASSES.HIDDEN);
const extractedData = await analisarTextoComIA(text);
document.getElementById('analise-spinner')?.classList.add(UI_CLASSES.HIDDEN);
if (extractedData) {
const currentData = coletarDadosDoFormulario();
const mergedData = mergeExtractedData(currentData, extractedData, text);
preencherFormulario(mergedData);
renderizarPreviews();
debouncedSave(document.getElementById('textarea-informacoes'));
showNotification('Dados extraídos da evolução anterior!',
NotificationTypes.INFO);
}
}, 500);
/** Manipula o evento 'blur' (perda de foco) dos campos do formulário.
*/
function handleFormBlur(event) {
try {
if (AppState.isProgrammaticChange) return;
const target = event.target;
if (!target || (target.tagName !== 'INPUT' && target.tagName !==
'TEXTAREA')) return;
const originalValue = target.value;
const newValue = toSentenceCase(originalValue);
if (target.id === 'textarea-informacoes') {
handleInformacoesBlurAnalysisDebounced(newValue);
return;
}
// Pular formatação de campos especiais que têm sua própria lógica
if (target.id === 'paciente-nome' || target.id ===
'textarea-diagnosticos') return;
if (newValue !== originalValue) {
AppState.isProgrammaticChange = true;
target.value = newValue;
AppState.isProgrammaticChange = false;
renderizarPreviewsDebounced();
debouncedSave(target);
}
} catch (error) { console.error("Erro inesperado no blur do
formulário:", error); if (typeof showNotification === 'function') {
showNotification("Erro ao formatar os dados.", NotificationTypes.ERROR);
} }
}
function initApp() {
if (document.body.dataset.initAppCalled) return;
const formContainer = document.getElementById('form-container'); const
textareaInformacoes = document.getElementById('textarea-informacoes');
const textareaDiagnosticos =
document.getElementById('textarea-diagnosticos'); const
textareaMedicamentosPrevios =
document.getElementById('textarea-medicamentos-previos');
const documentosContainer =
document.getElementById('conduta-documentos-container'); const
searchHistorico = document.getElementById('search-historico'); const
btnImprimirReceitas = document.getElementById('btn-imprimir-receitas');
const btnImprimirDocumentos =
document.getElementById('btn-imprimir-documentos');
const btnCopiarTodasReceitas =
document.getElementById('btn-copiar-todas-receitas'); const
btnCopiarTodosDocumentos =
document.getElementById('btn-copiar-todos-documentos'); const
btnVisitaMedica = document.getElementById('btn-visita-medica'); const
btnGerarVisita = document.getElementById('btn-gerar-visita'); const
receitaContainer = document.getElementById('receita-container');
document.body.addEventListener('click', handleGlobalClick);
formContainer?.addEventListener('input', handleFormInput);
formContainer?.addEventListener('blur', handleFormBlur, true);
textareaInformacoes?.addEventListener('paste', handlePastedText);
textareaDiagnosticos?.addEventListener('blur', (e) =>
debouncedDiagnosisInput(e.target));
documentosContainer?.addEventListener('change', (e) =>
handleDocumentOptionChange(e.target));
receitaContainer?.addEventListener('change', handleLmeCheckboxChange);
searchHistorico?.addEventListener('input', debounce((e) =>
searchPatients(e.target.value.toLowerCase()), 500));
btnImprimirReceitas?.addEventListener('click', () =>
printElementContent('receita-container', 'Receitas Médicas'));
btnImprimirDocumentos?.addEventListener('click', () =>
printElementContent('documentos-container', 'Documentos Médicos'));
btnCopiarTodasReceitas?.addEventListener('click', async () => { const
txt = Array.from(document.querySelectorAll('#receita-container
.preview-output')).map(c=>c.innerText).join('\n---\n'); await
copyTextToClipboard(txt); });
btnCopiarTodosDocumentos?.addEventListener('click', async () => { const
txt = Array.from(document.querySelectorAll('#documentos-container
.preview-output')).map(p=>p.innerText).join('\n---\n'); await
copyTextToClipboard(txt); });
btnVisitaMedica?.addEventListener('click', toggleVisitaMedicaMode);
btnGerarVisita?.addEventListener('click', handleGerarVisita);
textareaMedicamentosPrevios?.addEventListener('keydown', (e) => { if
(e.key === 'Enter') { e.preventDefault(); showNotification("Use vírgulas
para separar itens, não quebras de linha (Enter).",
NotificationTypes.INFO); } });
textareaMedicamentosPrevios?.addEventListener('input', (e) => { const
target = e.target; if (target.value.includes('\n')) {
AppState.isProgrammaticChange = true; target.value =
target.value.replace(/\n/g, ', ').replace(/, +/g, ', ').trim();
autoResizeTextarea(target); AppState.isProgrammaticChange = false;
renderizarPreviewsDebounced(); debouncedSave(target); } });
document.body.dataset.initAppCalled = 'true'; console.log("Listeners de
eventos da aplicação anexados.");
}
async function initFirebase() {
try {
if (!AppConfig.FIREBASE_CONFIG ||
Object.keys(AppConfig.FIREBASE_CONFIG).length === 0) { throw new
Error("Configuração do Firebase não encontrada."); }
const app = initializeApp(AppConfig.FIREBASE_CONFIG); AppState.db =
getFirestore(app); AppState.auth = getAuth(app); initApp();
onAuthStateChanged(AppState.auth, async (user) => {
AppState.userId = user?.uid || null; console.log("Firebase Auth State
Changed. UserID:", AppState.userId);
if (AppState.unsubscribePatientListener) {
AppState.unsubscribePatientListener();
AppState.unsubscribePatientListener = null; }
if (user) {
const lastPatientId = loadDataFromLocal(StorageKeys.LAST_PATIENT_ID);
if (lastPatientId && !lastPatientId.startsWith('local_')) {
loadPatient(lastPatientId); }
else if (lastPatientId?.startsWith('local_')) { handleNewPatient(); }
else {
setSyncState(true, "Buscando pacientes...");
try {
const pacientesCollectionPath =
`${AppConfig.FB_ROOT_COLLECTION}/${AppConfig.FIREBASE_APP_ID}/${AppConfig.FB_USERS_COLLECTION}/${AppState.userId}/${AppConfig.FB_PACIENTES_COLLECTION}`;
const patientsRef = collection(AppState.db, pacientesCollectionPath);
const q = query(patientsRef, orderBy('lastUpdate', 'desc'), limit(1));
const querySnapshot = await getDocs(q);
if (!querySnapshot.empty) { const lastPatientDoc =
querySnapshot.docs[0]; showNotification("Carregando último paciente...",
NotificationTypes.INFO); loadPatient(lastPatientDoc.id); }
else { handleNewPatient(); setSyncState(false); }
} catch (error) {
console.error("Erro ao buscar último paciente:", error);
if (error.code === 'failed-precondition') { showNotification("Erro: Crie
o índice 'lastUpdate' no Firestore.", NotificationTypes.ERROR);
console.error("ERRO CRÍTICO: Crie o índice 'lastUpdate' (decrescente) no
Firestore para a coleção 'pacientes'."); }
handleNewPatient(); setSyncState(false);
}
}
loadTodaysEvolutions();
} else { AppState.currentPatientId = null; handleNewPatient(); }
});
if (AppConfig.INITIAL_AUTH_TOKEN) await
signInWithCustomToken(AppState.auth,
AppConfig.INITIAL_AUTH_TOKEN).catch(err => console.error("Erro no
signInWithCustomToken:", err));
else { console.warn("Nenhum token inicial fornecido, tentando login
anônimo."); await signInAnonymously(AppState.auth).catch(err =>
console.error("Erro no signInAnonymously:", err)); }
} catch (error) { console.error("Falha Crítica - Inicialização do
Firebase:", error); showNotification(`Erro Firebase: ${error.message}`,
NotificationTypes.ERROR); AppState.userId = null; initApp();
handleNewPatient(); }
}
document.addEventListener('DOMContentLoaded', initFirebase);
</script>
</body>
</html>
